
/*
  Copyright (c) 2010, Nicolas Garcia Belmonte
  All rights reserved

  > Redistribution and use in source and binary forms, with or without
  > modification, are permitted provided that the following conditions are met:
  >      * Redistributions of source code must retain the above copyright
  >        notice, this list of conditions and the following disclaimer.
  >      * Redistributions in binary form must reproduce the above copyright
  >        notice, this list of conditions and the following disclaimer in the
  >        documentation and/or other materials provided with the distribution.
  >      * Neither the name of the organization nor the
  >        names of its contributors may be used to endorse or promote products
  >        derived from this software without specific prior written permission.
  >
  >  THIS SOFTWARE IS PROVIDED BY NICOLAS GARCIA BELMONTE ``AS IS'' AND ANY
  >  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
  >  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
  >  DISCLAIMED. IN NO EVENT SHALL NICOLAS GARCIA BELMONTE BE LIABLE FOR ANY
  >  DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
  >  (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
  >  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
  >  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
  >  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  >  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
 
 (function(){window.$jit=function(a){a=a||window;for(var d in $jit)if($jit[d].$extend)a[d]=$jit[d]};$jit.version="2.0.0b";var i=function(a){return document.getElementById(a)};i.empty=function(){};i.extend=function(a,d){for(var c in d||{})a[c]=d[c];return a};i.lambda=function(a){return typeof a=="function"?a:function(){return a}};i.time=Date.now||function(){return+new Date};i.splat=function(a){var d=i.type(a);return d?d!="array"?[a]:a:[]};i.type=function(a){var d=i.type.s.call(a).match(/^\[object\s(.*)\]$/)[1].toLowerCase();
if(d!="object")return d;if(a&&a.$$family)return a.$$family;return a&&a.nodeName&&a.nodeType==1?"element":d};i.type.s=Object.prototype.toString;i.each=function(a,d){if(i.type(a)=="object")for(var c in a)d(a[c],c);else{c=0;for(var b=a.length;c<b;c++)d(a[c],c)}};i.indexOf=function(a,d){if(Array.indexOf)return a.indexOf(d);for(var c=0,b=a.length;c<b;c++)if(a[c]===d)return c;return-1};i.map=function(a,d){var c=[];i.each(a,function(b,e){c.push(d(b,e))});return c};i.reduce=function(a,d,c){var b=a.length;
if(b==0)return c;for(var e=arguments.length==3?c:a[--b];b--;)e=d(e,a[b]);return e};i.merge=function(){for(var a={},d=0,c=arguments.length;d<c;d++){var b=arguments[d];if(i.type(b)=="object")for(var e in b){var f=b[e],g=a[e];a[e]=g&&i.type(f)=="object"&&i.type(g)=="object"?i.merge(g,f):i.unlink(f)}}return a};i.unlink=function(a){var d;switch(i.type(a)){case "object":d={};for(var c in a)d[c]=i.unlink(a[c]);break;case "array":d=[];c=0;for(var b=a.length;c<b;c++)d[c]=i.unlink(a[c]);break;default:return a}return d};
i.zip=function(){if(arguments.length===0)return[];for(var a=0,d=[],c=arguments.length,b=arguments[0].length;a<b;a++){for(var e=0,f=[];e<c;e++)f.push(arguments[e][a]);d.push(f)}return d};i.rgbToHex=function(a,d){if(a.length<3)return null;if(a.length==4&&a[3]==0&&!d)return"transparent";for(var c=[],b=0;b<3;b++){var e=(a[b]-0).toString(16);c.push(e.length==1?"0"+e:e)}return d?c:"#"+c.join("")};i.hexToRgb=function(a){if(a.length!=7){a=a.match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/);a.shift();if(a.length!=
3)return null;for(var d=[],c=0;c<3;c++){var b=a[c];if(b.length==1)b+=b;d.push(parseInt(b,16))}return d}else{a=parseInt(a.slice(1),16);return[a>>16,a>>8&255,a&255]}};i.destroy=function(a){i.clean(a);a.parentNode&&a.parentNode.removeChild(a);a.clearAttributes&&a.clearAttributes()};i.clean=function(a){a=a.childNodes;for(var d=0,c=a.length;d<c;d++)i.destroy(a[d])};i.addEvent=function(a,d,c){a.addEventListener?a.addEventListener(d,c,false):a.attachEvent("on"+d,c)};i.addEvents=function(a,d){for(var c in d)i.addEvent(a,
c,d[c])};i.hasClass=function(a,d){return(" "+a.className+" ").indexOf(" "+d+" ")>-1};i.addClass=function(a,d){if(!i.hasClass(a,d))a.className=a.className+" "+d};i.removeClass=function(a,d){a.className=a.className.replace(RegExp("(^|\\s)"+d+"(?:\\s|$)"),"$1")};i.getPos=function(a){var d=function(c){for(var b={x:0,y:0};c&&!/^(?:body|html)$/i.test(c.tagName);){b.x+=c.offsetLeft;b.y+=c.offsetTop;c=c.offsetParent}return b}(a);a=function(c){for(var b={x:0,y:0};c&&!/^(?:body|html)$/i.test(c.tagName);){b.x+=
c.scrollLeft;b.y+=c.scrollTop;c=c.parentNode}return b}(a);return{x:d.x-a.x,y:d.y-a.y}};i.event={get:function(a,d){d=d||window;return a||d.event},getWheel:function(a){return a.wheelDelta?a.wheelDelta/120:-(a.detail||0)/3},isRightClick:function(a){return a.which==3||a.button==2},getPos:function(a,d){d=d||window;a=a||d.event;var c=d.document;c=c.documentElement||c.body;if(a.touches&&a.touches.length)a=a.touches[0];return{x:a.pageX||a.clientX+c.scrollLeft,y:a.pageY||a.clientY+c.scrollTop}},stop:function(a){a.stopPropagation&&
a.stopPropagation();a.cancelBubble=true;if(a.preventDefault)a.preventDefault();else a.returnValue=false}};$jit.util=$jit.id=i;var v=function(a){a=a||{};var d=function(){for(var b in this)if(typeof this[b]!="function")this[b]=i.unlink(this[b]);this.constructor=d;if(v.prototyping)return this;b=this.initialize?this.initialize.apply(this,arguments):this;this.$$family="class";return b},c;for(c in v.Mutators)if(a[c]){a=v.Mutators[c](a,a[c]);delete a[c]}i.extend(d,this);d.constructor=v;d.prototype=a;return d};
v.Mutators={Implements:function(a,d){i.each(i.splat(d),function(c){v.prototyping=c;c=typeof c=="function"?new c:c;for(var b in c)b in a||(a[b]=c[b]);delete v.prototyping});return a}};i.extend(v,{inherit:function(a,d){for(var c in d){var b=d[c],e=a[c],f=i.type(b);if(e&&f=="function")b!=e&&v.override(a,c,b);else a[c]=f=="object"?i.merge(e,b):b}return a},override:function(a,d,c){var b=v.prototyping;if(b&&a[d]!=b[d])b=null;a[d]=function(){var e=this.parent;this.parent=b?b[d]:a[d];var f=c.apply(this,arguments);
this.parent=e;return f}}});v.prototype.implement=function(){var a=this.prototype;i.each(Array.prototype.slice.call(arguments||[]),function(d){v.inherit(a,d)});return this};$jit.Class=v;$jit.json={prune:function(a,d){this.each(a,function(c,b){if(b==d&&c.children){delete c.children;c.children=[]}})},getParent:function(a,d){if(a.id==d)return false;var c=a.children;if(c&&c.length>0)for(var b=0;b<c.length;b++)if(c[b].id==d)return a;else{var e=this.getParent(c[b],d);if(e)return e}return false},getSubtree:function(a,
d){if(a.id==d)return a;for(var c=0,b=a.children;c<b.length;c++){var e=this.getSubtree(b[c],d);if(e!=null)return e}return null},eachLevel:function(a,d,c,b){if(d<=c){b(a,d);if(a.children){var e=0;for(a=a.children;e<a.length;e++)this.eachLevel(a[e],d+1,c,b)}}},each:function(a,d){this.eachLevel(a,0,Number.MAX_VALUE,d)}};$jit.Trans={$extend:true,linear:function(a){return a}};var P=$jit.Trans;(function(){var a=function(d,c){c=i.splat(c);return i.extend(d,{easeIn:function(b){return d(b,c)},easeOut:function(b){return 1-
d(1-b,c)},easeInOut:function(b){return b<=0.5?d(2*b,c)/2:(2-d(2*(1-b),c))/2}})};i.each({Pow:function(d,c){return Math.pow(d,c[0]||6)},Expo:function(d){return Math.pow(2,8*(d-1))},Circ:function(d){return 1-Math.sin(Math.acos(d))},Sine:function(d){return 1-Math.sin((1-d)*Math.PI/2)},Back:function(d,c){c=c[0]||1.618;return Math.pow(d,2)*((c+1)*d-c)},Bounce:function(d){for(var c,b=0,e=1;;b+=e,e/=2)if(d>=(7-4*b)/11){c=e*e-Math.pow((11-6*b-11*d)/4,2);break}return c},Elastic:function(d,c){return Math.pow(2,
10*--d)*Math.cos(20*d*Math.PI*(c[0]||1)/3)}},function(d,c){P[c]=a(d)});i.each(["Quad","Cubic","Quart","Quint"],function(d,c){P[d]=a(function(b){return Math.pow(b,[c+2])})})})();var V=new v({initialize:function(a){this.setOptions(a)},setOptions:function(a){this.opt=i.merge({duration:2500,fps:40,transition:P.Quart.easeInOut,compute:i.empty,complete:i.empty,link:"ignore"},a||{});return this},step:function(){var a=i.time(),d=this.opt;if(a<this.time+d.duration){a=d.transition((a-this.time)/d.duration);
d.compute(a)}else{this.timer=clearInterval(this.timer);d.compute(1);d.complete()}},start:function(){if(!this.check())return this;this.time=0;this.startTimer();return this},startTimer:function(){var a=this,d=this.opt.fps;if(this.timer)return false;this.time=i.time()-this.time;this.timer=setInterval(function(){a.step()},Math.round(1E3/d));return true},pause:function(){this.stopTimer();return this},resume:function(){this.startTimer();return this},stopTimer:function(){if(!this.timer)return false;this.time=
i.time()-this.time;this.timer=clearInterval(this.timer);return true},check:function(){if(!this.timer)return true;if(this.opt.link=="cancel"){this.stopTimer();return true}return false}}),E=function(){for(var a=arguments,d=0,c=a.length,b={};d<c;d++){var e=E[a[d]];if(e.$extend)i.extend(b,e);else b[a[d]]=e}return b};E.AreaChart={$extend:true,animate:true,labelOffset:3,type:"stacked",Tips:{enable:false,onShow:i.empty,onHide:i.empty},Events:{enable:false,onClick:i.empty},selectOnHover:true,showAggregates:true,
showLabels:true,filterOnClick:false,restoreOnRightClick:false};E.Margin={$extend:false,top:0,left:0,right:0,bottom:0};E.Canvas={$extend:true,injectInto:"id",width:false,height:false,useCanvas:false,withLabels:true,background:false};E.Tree={$extend:true,orientation:"left",subtreeOffset:8,siblingOffset:5,indent:10,multitree:false,align:"center"};E.Node={$extend:false,overridable:false,type:"circle",color:"#ccb",alpha:1,dim:3,height:20,width:90,autoHeight:false,autoWidth:false,lineWidth:1,transform:true,
align:"center",angularWidth:1,span:1,CanvasStyles:{}};E.Edge={$extend:false,overridable:false,type:"line",color:"#ccb",lineWidth:1,dim:15,alpha:1,epsilon:7,CanvasStyles:{}};E.Fx={$extend:true,fps:40,duration:2500,transition:$jit.Trans.Quart.easeInOut,clearCanvas:true};E.Label={$extend:false,overridable:false,type:"HTML",style:" ",size:10,family:"sans-serif",textAlign:"center",textBaseline:"alphabetic",color:"#fff"};E.Tips={$extend:false,enable:false,type:"auto",offsetX:20,offsetY:20,force:false,onShow:i.empty,
onHide:i.empty};E.NodeStyles={$extend:false,enable:false,type:"auto",stylesHover:false,stylesClick:false};E.Events={$extend:false,enable:false,enableForEdges:false,type:"auto",onClick:i.empty,onRightClick:i.empty,onMouseMove:i.empty,onMouseEnter:i.empty,onMouseLeave:i.empty,onDragStart:i.empty,onDragMove:i.empty,onDragCancel:i.empty,onDragEnd:i.empty,onTouchStart:i.empty,onTouchMove:i.empty,onTouchEnd:i.empty,onMouseWheel:i.empty};E.Navigation={$extend:false,enable:false,type:"auto",panning:false,
zooming:false};E.Controller={$extend:true,onBeforeCompute:i.empty,onAfterCompute:i.empty,onCreateLabel:i.empty,onPlaceLabel:i.empty,onComplete:i.empty,onBeforePlotLine:i.empty,onAfterPlotLine:i.empty,onBeforePlotNode:i.empty,onAfterPlotNode:i.empty,request:false};var R={initialize:function(a,d){this.viz=d;this.canvas=d.canvas;this.config=d.config[a];this.nodeTypes=d.fx.nodeTypes;var c=this.config.type;this.labelContainer=(this.dom=c=="auto"?d.config.Label.type!="Native":c!="Native")&&d.labels.getLabelContainer();
this.isEnabled()&&this.initializePost()},initializePost:i.empty,setAsProperty:i.lambda(false),isEnabled:function(){return this.config.enable},isLabel:function(a,d){a=i.event.get(a,d);var c=this.labelContainer,b=a.target||a.srcElement;if(b&&b.parentNode==c)return b;return false}},S={onMouseUp:i.empty,onMouseDown:i.empty,onMouseMove:i.empty,onMouseOver:i.empty,onMouseOut:i.empty,onMouseWheel:i.empty,onTouchStart:i.empty,onTouchMove:i.empty,onTouchEnd:i.empty,onTouchCancel:i.empty},da=new v({initialize:function(a){this.viz=
a;this.canvas=a.canvas;this.edge=this.node=false;this.registeredObjects=[];this.attachEvents()},attachEvents:function(){var a=this.canvas.getElement(),d=this;a.oncontextmenu=i.lambda(false);i.addEvents(a,{mouseup:function(b,e){var f=i.event.get(b,e);d.handleEvent("MouseUp",b,e,d.makeEventObject(b,e),i.event.isRightClick(f))},mousedown:function(b,e){var f=i.event.get(b,e);d.handleEvent("MouseDown",b,e,d.makeEventObject(b,e),i.event.isRightClick(f))},mousemove:function(b,e){d.handleEvent("MouseMove",
b,e,d.makeEventObject(b,e))},mouseover:function(b,e){d.handleEvent("MouseOver",b,e,d.makeEventObject(b,e))},mouseout:function(b,e){d.handleEvent("MouseOut",b,e,d.makeEventObject(b,e))},touchstart:function(b,e){d.handleEvent("TouchStart",b,e,d.makeEventObject(b,e))},touchmove:function(b,e){d.handleEvent("TouchMove",b,e,d.makeEventObject(b,e))},touchend:function(b,e){d.handleEvent("TouchEnd",b,e,d.makeEventObject(b,e))}});var c=function(b,e){var f=i.event.get(b,e);f=i.event.getWheel(f);d.handleEvent("MouseWheel",
b,e,f)};!document.getBoxObjectFor&&window.mozInnerScreenX==null?i.addEvent(a,"mousewheel",c):a.addEventListener("DOMMouseScroll",c,false)},register:function(a){this.registeredObjects.push(a)},handleEvent:function(){for(var a=Array.prototype.slice.call(arguments),d=a.shift(),c=0,b=this.registeredObjects,e=b.length;c<e;c++)b[c]["on"+d].apply(b[c],a)},makeEventObject:function(a,d){var c=this,b=this.viz.graph,e=this.viz.fx,f=e.nodeTypes,g=e.edgeTypes;return{pos:false,node:false,edge:false,contains:false,
getNodeCalled:false,getEdgeCalled:false,getPos:function(){var h=c.viz.canvas,j=h.getSize(),k=h.getPos(),n=h.translateOffsetX,l=h.translateOffsetY,m=h.scaleOffsetX;h=h.scaleOffsetY;var o=i.event.getPos(a,d);return this.pos={x:(o.x-k.x-j.width/2-n)*1/m,y:(o.y-k.y-j.height/2-l)*1/h}},getNode:function(){if(this.getNodeCalled)return this.node;this.getNodeCalled=true;for(var h in b.nodes){var j=b.nodes[h],k=j&&f[j.getData("type")];if(k=k&&k.contains&&k.contains.call(e,j,this.getPos())){this.contains=k;
return c.node=this.node=j}}return c.node=this.node=false},getEdge:function(){if(this.getEdgeCalled)return this.edge;this.getEdgeCalled=true;var h={},j;for(j in b.edges){var k=b.edges[j];h[j]=true;for(var n in k)if(!(n in h)){var l=k[n],m=l&&g[l.getData("type")];if(m=m&&m.contains&&m.contains.call(e,l,this.getPos())){this.contains=m;return c.edge=this.edge=l}}}return c.edge=this.edge=false},getContains:function(){if(this.getNodeCalled)return this.contains;this.getNode();return this.contains}}}}),L=
{initializeExtras:function(){var a=new da(this),d=this;i.each(["NodeStyles","Tips","Navigation","Events"],function(c){var b=new L.Classes[c](c,d);b.isEnabled()&&a.register(b);if(b.setAsProperty())d[c.toLowerCase()]=b})}};L.Classes={};L.Classes.Events=new v({Implements:[R,S],initializePost:function(){this.fx=this.viz.fx;this.ntypes=this.viz.fx.nodeTypes;this.etypes=this.viz.fx.edgeTypes;this.moved=this.touchMoved=this.touched=this.pressed=this.hovered=false},setAsProperty:i.lambda(true),onMouseUp:function(a,
d,c,b){a=i.event.get(a,d);this.moved||(b?this.config.onRightClick(this.hovered,c,a):this.config.onClick(this.pressed,c,a));if(this.pressed){this.moved?this.config.onDragEnd(this.pressed,c,a):this.config.onDragCancel(this.pressed,c,a);this.pressed=this.moved=false}},onMouseOut:function(a,d,c){var b=i.event.get(a,d),e;if(this.dom&&(e=this.isLabel(a,d))){this.config.onMouseLeave(this.viz.graph.getNode(e.id),c,b);this.hovered=false}else{a=b.relatedTarget;for(d=this.canvas.getElement();a&&a.parentNode;){if(d==
a.parentNode)return;a=a.parentNode}if(this.hovered){this.config.onMouseLeave(this.hovered,c,b);this.hovered=false}}},onMouseOver:function(a,d,c){var b=i.event.get(a,d),e;if(this.dom&&(e=this.isLabel(a,d))){this.hovered=this.viz.graph.getNode(e.id);this.config.onMouseEnter(this.hovered,c,b)}},onMouseMove:function(a,d,c){a=i.event.get(a,d);if(this.pressed){this.moved=true;this.config.onDragMove(this.pressed,c,a)}else if(this.dom)this.config.onMouseMove(this.hovered,c,a);else{if(this.hovered){d=this.hovered;
var b=d.nodeFrom?this.etypes[d.getData("type")]:this.ntypes[d.getData("type")];if(b&&b.contains&&b.contains.call(this.fx,d,c.getPos())){this.config.onMouseMove(d,c,a);return}else{this.config.onMouseLeave(d,c,a);this.hovered=false}}(this.hovered=c.getNode()||this.config.enableForEdges&&c.getEdge())?this.config.onMouseEnter(this.hovered,c,a):this.config.onMouseMove(false,c,a)}},onMouseWheel:function(a,d,c){this.config.onMouseWheel(c,i.event.get(a,d))},onMouseDown:function(a,d,c){a=i.event.get(a,d);
this.pressed=c.getNode()||this.config.enableForEdges&&c.getEdge();this.config.onDragStart(this.pressed,c,a)},onTouchStart:function(a,d,c){a=i.event.get(a,d);this.touched=c.getNode()||this.config.enableForEdges&&c.getEdge();this.config.onTouchStart(this.touched,c,a)},onTouchMove:function(a,d,c){a=i.event.get(a,d);if(this.touched){this.touchMoved=true;this.config.onTouchMove(this.touched,c,a)}},onTouchEnd:function(a,d,c){a=i.event.get(a,d);if(this.touched){this.touchMoved?this.config.onTouchEnd(this.touched,
c,a):this.config.onTouchCancel(this.touched,c,a);this.touched=this.touchMoved=false}}});L.Classes.Tips=new v({Implements:[R,S],initializePost:function(){if(document.body){var a=i("_tooltip")||document.createElement("div");a.id="_tooltip";a.className="tip";i.extend(a.style,{position:"absolute",display:"none",zIndex:13E3});document.body.appendChild(a);this.tip=a;this.node=false}},setAsProperty:i.lambda(true),onMouseOut:function(a,d){if(this.dom&&this.isLabel(a,d))this.hide(true);else{for(var c=a.relatedTarget,
b=this.canvas.getElement();c&&c.parentNode;){if(b==c.parentNode)return;c=c.parentNode}this.hide(false)}},onMouseOver:function(a,d){var c;if(this.dom&&(c=this.isLabel(a,d))){this.node=this.viz.graph.getNode(c.id);this.config.onShow(this.tip,this.node,c)}},onMouseMove:function(a,d,c){this.dom&&this.isLabel(a,d)&&this.setTooltipPosition(i.event.getPos(a,d));if(!this.dom){var b=c.getNode();if(b){if(this.config.force||!this.node||this.node.id!=b.id){this.node=b;this.config.onShow(this.tip,b,c.getContains())}this.setTooltipPosition(i.event.getPos(a,
d))}else this.hide(true)}},setTooltipPosition:function(a){var d=this.tip,c=d.style,b=this.config;c.display="";var e={height:document.body.clientHeight,width:document.body.clientWidth};d={width:d.offsetWidth,height:d.offsetHeight};var f=b.offsetX;b=b.offsetY;c.top=(a.y+b+d.height>e.height?a.y-d.height-b:a.y+b)+"px";c.left=(a.x+d.width+f>e.width?a.x-d.width-f:a.x+f)+"px"},hide:function(a){this.tip.style.display="none";a&&this.config.onHide()}});L.Classes.NodeStyles=new v({Implements:[R,S],initializePost:function(){this.fx=
this.viz.fx;this.types=this.viz.fx.nodeTypes;this.nStyles=this.config;this.nodeStylesOnHover=this.nStyles.stylesHover;this.nodeStylesOnClick=this.nStyles.stylesClick;this.hoveredNode=false;this.fx.nodeFxAnimation=new V;this.move=this.down=false},onMouseOut:function(a,d){this.down=this.move=false;if(this.hoveredNode){this.dom&&this.isLabel(a,d)&&this.toggleStylesOnHover(this.hoveredNode,false);for(var c=a.relatedTarget,b=this.canvas.getElement();c&&c.parentNode;){if(b==c.parentNode)return;c=c.parentNode}this.toggleStylesOnHover(this.hoveredNode,
false);this.hoveredNode=false}},onMouseOver:function(a,d){var c;if(this.dom&&(c=this.isLabel(a,d))){c=this.viz.graph.getNode(c.id);if(!c.selected){this.hoveredNode=c;this.toggleStylesOnHover(this.hoveredNode,true)}}},onMouseDown:function(a,d,c,b){if(!b){var e;if(this.dom&&(e=this.isLabel(a,d)))this.down=this.viz.graph.getNode(e.id);else if(!this.dom)this.down=c.getNode();this.move=false}},onMouseUp:function(a,d,c,b){if(!b){this.move||this.onClick(c.getNode());this.down=this.move=false}},getRestoredStyles:function(a,
d){var c={},b=this["nodeStylesOn"+d],e;for(e in b)c[e]=a.styles["$"+e];return c},toggleStylesOnHover:function(a,d){this.nodeStylesOnHover&&this.toggleStylesOn("Hover",a,d)},toggleStylesOnClick:function(a,d){this.nodeStylesOnClick&&this.toggleStylesOn("Click",a,d)},toggleStylesOn:function(a,d,c){var b=this.viz;if(c){if(!d.styles)d.styles=i.merge(d.data,{});for(var e in this["nodeStylesOn"+a]){c="$"+e;c in d.styles||(d.styles[c]=d.getData(e))}b.fx.nodeFx(i.extend({elements:{id:d.id,properties:this["nodeStylesOn"+
a]},transition:P.Quart.easeOut,duration:300,fps:40},this.config))}else{a=this.getRestoredStyles(d,a);b.fx.nodeFx(i.extend({elements:{id:d.id,properties:a},transition:P.Quart.easeOut,duration:300,fps:40},this.config))}},onClick:function(a){if(a){var d=this.nodeStylesOnClick;if(d)if(a.selected){this.toggleStylesOnClick(a,false);delete a.selected}else{this.viz.graph.eachNode(function(c){if(c.selected){for(var b in d)c.setData(b,c.styles["$"+b],"end");delete c.selected}});this.toggleStylesOnClick(a,true);
a.selected=true;delete a.hovered;this.hoveredNode=false}}},onMouseMove:function(a,d,c){if(this.down)this.move=true;if(!(this.dom&&this.isLabel(a,d))){var b=this.nodeStylesOnHover;if(b)if(!this.dom){if(this.hoveredNode)if((a=this.types[this.hoveredNode.getData("type")])&&a.contains&&a.contains.call(this.fx,this.hoveredNode,c.getPos()))return;c=c.getNode();if(this.hoveredNode||c)if(!c.hovered)if(c&&!c.selected){this.fx.nodeFxAnimation.stopTimer();this.viz.graph.eachNode(function(e){if(e.hovered&&!e.selected){for(var f in b)e.setData(f,
e.styles["$"+f],"end");delete e.hovered}});c.hovered=true;this.hoveredNode=c;this.toggleStylesOnHover(c,true)}else if(this.hoveredNode&&!this.hoveredNode.selected){this.fx.nodeFxAnimation.stopTimer();this.toggleStylesOnHover(this.hoveredNode,false);delete this.hoveredNode.hovered;this.hoveredNode=false}}}}});L.Classes.Navigation=new v({Implements:[R,S],initializePost:function(){this.pressed=this.pos=false},onMouseWheel:function(a,d,c){if(this.config.zooming){i.event.stop(i.event.get(a,d));a=1+c*(this.config.zooming/
1E3);this.canvas.scale(a,a)}},onMouseDown:function(a,d,c){if(this.config.panning)if(!(this.config.panning=="avoid nodes"&&c.getNode())){this.pressed=true;this.pos=c.getPos();a=this.canvas;d=a.translateOffsetX;c=a.translateOffsetY;var b=a.scaleOffsetY;this.pos.x*=a.scaleOffsetX;this.pos.x+=d;this.pos.y*=b;this.pos.y+=c}},onMouseMove:function(a,d,c){if(this.config.panning)if(this.pressed)if(!(this.config.panning=="avoid nodes"&&c.getNode())){a=this.pos;c=c.getPos();var b=this.canvas,e=b.translateOffsetX,
f=b.translateOffsetY;d=b.scaleOffsetX;b=b.scaleOffsetY;c.x*=d;c.y*=b;c.x+=e;c.y+=f;e=c.x-a.x;a=c.y-a.y;this.pos=c;this.canvas.translate(e*1/d,a*1/b)}},onMouseUp:function(){if(this.config.panning)this.pressed=false}});var K;(function(){function a(b,e){var f=document.createElement(b),g;for(g in e)if(typeof e[g]=="object")i.extend(f[g],e[g]);else f[g]=e[g];if(b=="canvas"&&!c&&G_vmlCanvasManager)f=G_vmlCanvasManager.initElement(document.body.appendChild(f));return f}var d=typeof HTMLCanvasElement,c=d==
"object"||d=="function";$jit.Canvas=K=new v({canvases:[],pos:false,element:false,labelContainer:false,translateOffsetX:0,translateOffsetY:0,scaleOffsetX:1,scaleOffsetY:1,initialize:function(b,e){this.viz=b;this.opt=e;var f=i.type(e.injectInto)=="string"?e.injectInto:e.injectInto.id,g=f+"-label",h=i(f),j=e.width||h.offsetWidth,k=e.height||h.offsetHeight;this.id=f;var n={injectInto:f,width:j,height:k};this.element=a("div",{id:f+"-canvaswidget",style:{position:"relative",width:j+"px",height:k+"px"}});
this.labelContainer=this.createLabelContainer(e.Label.type,g,n);this.canvases.push(new K.Base({config:i.extend({idSuffix:"-canvas"},n),plot:function(){b.fx.plot()},resize:function(){b.refresh()}}));if(f=e.background){n=new K.Background[f.type](b,i.extend(f,n));this.canvases.push(new K.Base(n))}for(n=this.canvases.length;n--;){this.element.appendChild(this.canvases[n].canvas);n>0&&this.canvases[n].plot()}this.element.appendChild(this.labelContainer);h.appendChild(this.element);var l=null,m=this;i.addEvent(window,
"scroll",function(){clearTimeout(l);l=setTimeout(function(){m.getPos(true)},500)})},getCtx:function(b){return this.canvases[b||0].getCtx()},getConfig:function(){return this.opt},getElement:function(){return this.element},getSize:function(b){return this.canvases[b||0].getSize()},resize:function(b,e){this.getPos(true);this.translateOffsetX=this.translateOffsetY=0;this.scaleOffsetX=this.scaleOffsetY=1;for(var f=0,g=this.canvases.length;f<g;f++)this.canvases[f].resize(b,e);f=this.element.style;f.width=
b+"px";f.height=e+"px";if(this.labelContainer)this.labelContainer.style.width=b+"px"},translate:function(b,e,f){this.translateOffsetX+=b*this.scaleOffsetX;this.translateOffsetY+=e*this.scaleOffsetY;for(var g=0,h=this.canvases.length;g<h;g++)this.canvases[g].translate(b,e,f)},scale:function(b,e){var f=this.scaleOffsetX*b,g=this.scaleOffsetY*e,h=this.translateOffsetX*(b-1)/f,j=this.translateOffsetY*(e-1)/g;this.scaleOffsetX=f;this.scaleOffsetY=g;f=0;for(g=this.canvases.length;f<g;f++)this.canvases[f].scale(b,
e,true);this.translate(h,j,false)},getPos:function(b){if(b||!this.pos)return this.pos=i.getPos(this.getElement());return this.pos},clear:function(b){this.canvases[b||0].clear()},path:function(b,e){var f=this.canvases[0].getCtx();f.beginPath();e(f);f[b]();f.closePath()},createLabelContainer:function(b,e,f){if(b=="HTML"||b=="Native")return a("div",{id:e,style:{overflow:"visible",position:"absolute",top:0,left:0,width:f.width+"px",height:0}});else if(b=="SVG"){b=document.createElementNS("http://www.w3.org/2000/svg",
"svg:svg");b.setAttribute("width",f.width);b.setAttribute("height",f.height);var g=b.style;g.position="absolute";g.left=g.top="0px";g=document.createElementNS("http://www.w3.org/2000/svg","svg:g");g.setAttribute("width",f.width);g.setAttribute("height",f.height);g.setAttribute("x",0);g.setAttribute("y",0);g.setAttribute("id",e);b.appendChild(g);return b}}});K.Base=new v({translateOffsetX:0,translateOffsetY:0,scaleOffsetX:1,scaleOffsetY:1,initialize:function(b){this.viz=b;this.opt=b.config;this.size=
false;this.createCanvas();this.translateToCenter()},createCanvas:function(){var b=this.opt,e=b.width,f=b.height;this.canvas=a("canvas",{id:b.injectInto+b.idSuffix,width:e,height:f,style:{position:"absolute",top:0,left:0,width:e+"px",height:f+"px"}})},getCtx:function(){if(!this.ctx)return this.ctx=this.canvas.getContext("2d");return this.ctx},getSize:function(){if(this.size)return this.size;var b=this.canvas;return this.size={width:b.width,height:b.height}},translateToCenter:function(b){var e=this.getSize(),
f=b?e.width-b.width-this.translateOffsetX*2:e.width;height=b?e.height-b.height-this.translateOffsetY*2:e.height;e=this.getCtx();b&&e.scale(1/this.scaleOffsetX,1/this.scaleOffsetY);e.translate(f/2,height/2)},resize:function(b,e){var f=this.getSize(),g=this.canvas,h=g.style;this.size=false;g.width=b;g.height=e;h.width=b+"px";h.height=e+"px";c?this.translateToCenter():this.translateToCenter(f);this.translateOffsetX=this.translateOffsetY=0;this.scaleOffsetX=this.scaleOffsetY=1;this.clear();this.viz.resize(b,
e,this)},translate:function(b,e,f){var g=this.scaleOffsetY;this.translateOffsetX+=b*this.scaleOffsetX;this.translateOffsetY+=e*g;this.getCtx().translate(b,e);!f&&this.plot()},scale:function(b,e,f){this.scaleOffsetX*=b;this.scaleOffsetY*=e;this.getCtx().scale(b,e);!f&&this.plot()},clear:function(){var b=this.getSize(),e=this.translateOffsetX,f=this.translateOffsetY,g=this.scaleOffsetX,h=this.scaleOffsetY;this.getCtx().clearRect((-b.width/2-e)*1/g,(-b.height/2-f)*1/h,b.width*1/g,b.height*1/h)},plot:function(){this.clear();
this.viz.plot(this)}});K.Background={};K.Background.Circles=new v({initialize:function(b,e){this.viz=b;this.config=i.merge({idSuffix:"-bkcanvas",levelDistance:100,numberOfCircles:6,CanvasStyles:{},offset:0},e)},resize:function(b,e,f){this.plot(f)},plot:function(b){b=b.getCtx();var e=this.config,f=e.CanvasStyles,g;for(g in f)b[g]=f[g];g=e.numberOfCircles;e=e.levelDistance;for(f=1;f<=g;f++){b.beginPath();b.arc(0,0,e*f,0,2*Math.PI,false);b.stroke();b.closePath()}}})})();var F=function(a,d){this.theta=
a;this.rho=d};$jit.Polar=F;F.prototype={getc:function(a){return this.toComplex(a)},getp:function(){return this},set:function(a){a=a.getp();this.theta=a.theta;this.rho=a.rho},setc:function(a,d){this.rho=Math.sqrt(a*a+d*d);this.theta=Math.atan2(d,a);if(this.theta<0)this.theta+=Math.PI*2},setp:function(a,d){this.theta=a;this.rho=d},clone:function(){return new F(this.theta,this.rho)},toComplex:function(a){var d=Math.cos(this.theta)*this.rho,c=Math.sin(this.theta)*this.rho;if(a)return{x:d,y:c};return new G(d,
c)},add:function(a){return new F(this.theta+a.theta,this.rho+a.rho)},scale:function(a){return new F(this.theta,this.rho*a)},equals:function(a){return this.theta==a.theta&&this.rho==a.rho},$add:function(a){this.theta+=a.theta;this.rho+=a.rho;return this},$madd:function(a){this.theta=(this.theta+a.theta)%(Math.PI*2);this.rho+=a.rho;return this},$scale:function(a){this.rho*=a;return this},interpolate:function(a,d){var c=Math.PI,b=c*2,e=function(j){return j<0?j%b+b:j%b},f=this.theta,g=a.theta,h=Math.abs(f-
g);return{theta:h==c?f>g?e(g+(f-b-g)*d):e(g-b+(f-g)*d):h>=c?f>g?e(g+(f-b-g)*d):e(g-b+(f-(g-b))*d):e(g+(f-g)*d),rho:(this.rho-a.rho)*d+a.rho}}};F.KER=new F(0,0);var G=function(a,d){this.x=a;this.y=d};$jit.Complex=G;G.prototype={getc:function(){return this},getp:function(a){return this.toPolar(a)},set:function(a){a=a.getc(true);this.x=a.x;this.y=a.y},setc:function(a,d){this.x=a;this.y=d},setp:function(a,d){this.x=Math.cos(a)*d;this.y=Math.sin(a)*d},clone:function(){return new G(this.x,this.y)},toPolar:function(a){var d=
this.norm(),c=Math.atan2(this.y,this.x);if(c<0)c+=Math.PI*2;if(a)return{theta:c,rho:d};return new F(c,d)},norm:function(){return Math.sqrt(this.squaredNorm())},squaredNorm:function(){return this.x*this.x+this.y*this.y},add:function(a){return new G(this.x+a.x,this.y+a.y)},prod:function(a){return new G(this.x*a.x-this.y*a.y,this.y*a.x+this.x*a.y)},conjugate:function(){return new G(this.x,-this.y)},scale:function(a){return new G(this.x*a,this.y*a)},equals:function(a){return this.x==a.x&&this.y==a.y},
$add:function(a){this.x+=a.x;this.y+=a.y;return this},$prod:function(a){var d=this.x,c=this.y;this.x=d*a.x-c*a.y;this.y=c*a.x+d*a.y;return this},$conjugate:function(){this.y=-this.y;return this},$scale:function(a){this.x*=a;this.y*=a;return this},$div:function(a){var d=this.x,c=this.y,b=a.squaredNorm();this.x=d*a.x+c*a.y;this.y=c*a.x-d*a.y;return this.$scale(1/b)}};G.KER=new G(0,0);$jit.Graph=new v({initialize:function(a,d,c,b){this.Node=d;this.Edge=c;this.Label=b;this.opt=i.merge({complex:false,
Node:{}},a||{});this.nodes={};this.edges={};var e=this;this.nodeList={};for(var f in T)e.nodeList[f]=function(g){return function(){var h=Array.prototype.slice.call(arguments);e.eachNode(function(j){j[g].apply(j,h)})}}(f)},getNode:function(a){if(this.hasNode(a))return this.nodes[a];return false},getByName:function(a){for(var d in this.nodes){var c=this.nodes[d];if(c.name==a)return c}return false},getAdjacence:function(a,d){if(a in this.edges)return this.edges[a][d];return false},addNode:function(a){if(!this.nodes[a.id]){var d=
this.edges[a.id]={};this.nodes[a.id]=new y.Node(i.extend({id:a.id,name:a.name,data:i.merge(a.data||{},{}),adjacencies:d},this.opt.Node),this.opt.complex,this.Node,this.Edge,this.Label)}return this.nodes[a.id]},addAdjacence:function(a,d,c){this.hasNode(a.id)||this.addNode(a);this.hasNode(d.id)||this.addNode(d);a=this.nodes[a.id];d=this.nodes[d.id];if(!a.adjacentTo(d)){var b=this.edges[a.id]=this.edges[a.id]||{},e=this.edges[d.id]=this.edges[d.id]||{};b[d.id]=e[a.id]=new y.Adjacence(a,d,c,this.Edge,
this.Label);return b[d.id]}return this.edges[a.id][d.id]},removeNode:function(a){if(this.hasNode(a)){delete this.nodes[a];var d=this.edges[a],c;for(c in d)delete this.edges[c][a];delete this.edges[a]}},removeAdjacence:function(a,d){delete this.edges[a][d];delete this.edges[d][a]},hasNode:function(a){return a in this.nodes},empty:function(){this.nodes={};this.edges={}}});var y=$jit.Graph,T;(function(){var a=function(b,e,f,g,h){var j;f=f||"current";b="$"+(b?b+"-":"");if(f=="current")j=this.data;else if(f==
"start")j=this.startData;else if(f=="end")j=this.endData;b=b+e;if(g)return j[b];if(!this.Config.overridable)return h[e]||0;return b in j?j[b]:b in this.data?this.data[b]:h[e]||0},d=function(b,e,f,g){g=g||"current";b="$"+(b?b+"-":"");var h;if(g=="current")h=this.data;else if(g=="start")h=this.startData;else if(g=="end")h=this.endData;h[b+e]=f},c=function(b,e){b="$"+(b?b+"-":"");var f=this;i.each(e,function(g){g=b+g;delete f.data[g];delete f.endData[g];delete f.startData[g]})};T={getData:function(b,
e,f){return a.call(this,"",b,e,f,this.Config)},setData:function(b,e,f){d.call(this,"",b,e,f)},setDataset:function(b,e){b=i.splat(b);for(var f in e)for(var g=0,h=i.splat(e[f]),j=b.length;g<j;g++)this.setData(f,h[g],b[g])},removeData:function(){c.call(this,"",Array.prototype.slice.call(arguments))},getCanvasStyle:function(b,e,f){return a.call(this,"canvas",b,e,f,this.Config.CanvasStyles)},setCanvasStyle:function(b,e,f){d.call(this,"canvas",b,e,f)},setCanvasStyles:function(b,e){b=i.splat(b);for(var f in e)for(var g=
0,h=i.splat(e[f]),j=b.length;g<j;g++)this.setCanvasStyle(f,h[g],b[g])},removeCanvasStyle:function(){c.call(this,"canvas",Array.prototype.slice.call(arguments))},getLabelData:function(b,e,f){return a.call(this,"label",b,e,f,this.Label)},setLabelData:function(b,e,f){d.call(this,"label",b,e,f)},setLabelDataset:function(b,e){b=i.splat(b);for(var f in e)for(var g=0,h=i.splat(e[f]),j=b.length;g<j;g++)this.setLabelData(f,h[g],b[g])},removeLabelData:function(){c.call(this,"label",Array.prototype.slice.call(arguments))}}})();
y.Node=new v({initialize:function(a,d,c,b,e){d={id:"",name:"",data:{},startData:{},endData:{},adjacencies:{},selected:false,drawn:false,exist:false,angleSpan:{begin:0,end:0},pos:d&&new G(0,0)||new F(0,0),startPos:d&&new G(0,0)||new F(0,0),endPos:d&&new G(0,0)||new F(0,0)};i.extend(this,i.extend(d,a));this.Config=this.Node=c;this.Edge=b;this.Label=e},adjacentTo:function(a){return a.id in this.adjacencies},getAdjacency:function(a){return this.adjacencies[a]},getPos:function(a){a=a||"current";if(a==
"current")return this.pos;else if(a=="end")return this.endPos;else if(a=="start")return this.startPos},setPos:function(a,d){d=d||"current";var c;if(d=="current")c=this.pos;else if(d=="end")c=this.endPos;else if(d=="start")c=this.startPos;c.set(a)}});y.Node.implement(T);y.Adjacence=new v({initialize:function(a,d,c,b,e){this.nodeFrom=a;this.nodeTo=d;this.data=c||{};this.startData={};this.endData={};this.Config=this.Edge=b;this.Label=e}});y.Adjacence.implement(T);y.Util={filter:function(a){if(!a||i.type(a)!=
"string")return function(){return true};var d=a.split(" ");return function(c){for(var b=0;b<d.length;b++)if(c[d[b]])return false;return true}},getNode:function(a,d){return a.nodes[d]},eachNode:function(a,d,c){c=this.filter(c);for(var b in a.nodes)c(a.nodes[b])&&d(a.nodes[b])},eachAdjacency:function(a,d,c){var b=a.adjacencies;c=this.filter(c);for(var e in b){var f=b[e];if(c(f)){if(f.nodeFrom!=a){var g=f.nodeFrom;f.nodeFrom=f.nodeTo;f.nodeTo=g}d(f,e)}}},computeLevels:function(a,d,c,b){c=c||0;var e=
this.filter(b);this.eachNode(a,function(h){h._flag=false;h._depth=-1},b);a=a.getNode(d);a._depth=c;for(var f=[a];f.length!=0;){var g=f.pop();g._flag=true;this.eachAdjacency(g,function(h){h=h.nodeTo;if(h._flag==false&&e(h)){if(h._depth<0)h._depth=g._depth+1+c;f.unshift(h)}},b)}},eachBFS:function(a,d,c,b){var e=this.filter(b);this.clean(a);for(var f=[a.getNode(d)];f.length!=0;){a=f.pop();a._flag=true;c(a,a._depth);this.eachAdjacency(a,function(g){g=g.nodeTo;if(g._flag==false&&e(g)){g._flag=true;f.unshift(g)}},
b)}},eachLevel:function(a,d,c,b,e){var f=a._depth,g=this.filter(e),h=this;c=c===false?Number.MAX_VALUE-f:c;(function j(k,n,l){var m=k._depth;m>=n&&m<=l&&g(k)&&b(k,m);m<l&&h.eachAdjacency(k,function(o){o=o.nodeTo;o._depth>m&&j(o,n,l)})})(a,d+f,c+f)},eachSubgraph:function(a,d,c){this.eachLevel(a,0,false,d,c)},eachSubnode:function(a,d,c){this.eachLevel(a,1,1,d,c)},anySubnode:function(a,d,c){var b=false;d=d||i.lambda(true);var e=i.type(d)=="string"?function(f){return f[d]}:d;this.eachSubnode(a,function(f){if(e(f))b=
true},c);return b},getSubnodes:function(a,d,c){var b=[];d=d||0;var e;if(i.type(d)=="array"){e=d[0];d=d[1]}else{e=d;d=Number.MAX_VALUE-a._depth}this.eachLevel(a,e,d,function(f){b.push(f)},c);return b},getParents:function(a){var d=[];this.eachAdjacency(a,function(c){c=c.nodeTo;c._depth<a._depth&&d.push(c)});return d},isDescendantOf:function(a,d){if(a.id==d)return true;for(var c=this.getParents(a),b=false,e=0;!b&&e<c.length;e++)b=b||this.isDescendantOf(c[e],d);return b},clean:function(a){this.eachNode(a,
function(d){d._flag=false})},getClosestNodeToOrigin:function(a,d,c){return this.getClosestNodeToPos(a,F.KER,d,c)},getClosestNodeToPos:function(a,d,c,b){var e=null;c=c||"current";d=d&&d.getc(true)||G.KER;var f=function(g,h){var j=g.x-h.x,k=g.y-h.y;return j*j+k*k};this.eachNode(a,function(g){e=e==null||f(g.getPos(c).getc(true),d)<f(e.getPos(c).getc(true),d)?g:e},b);return e}};i.each(["getNode","eachNode","computeLevels","eachBFS","clean","getClosestNodeToPos","getClosestNodeToOrigin"],function(a){y.prototype[a]=
function(){return y.Util[a].apply(y.Util,[this].concat(Array.prototype.slice.call(arguments)))}});i.each(["eachAdjacency","eachLevel","eachSubgraph","eachSubnode","anySubnode","getSubnodes","getParents","isDescendantOf"],function(a){y.Node.prototype[a]=function(){return y.Util[a].apply(y.Util,[this].concat(Array.prototype.slice.call(arguments)))}});y.Op={options:{type:"nothing",duration:2E3,hideLabels:true,fps:30},initialize:function(a){this.viz=a},removeNode:function(a,d){var c=this.viz,b=i.merge(this.options,
c.controller,d),e=i.splat(a),f,g,h;switch(b.type){case "nothing":for(f=0;f<e.length;f++)c.graph.removeNode(e[f]);break;case "replot":this.removeNode(e,{type:"nothing"});c.labels.clearLabels();c.refresh(true);break;case "fade:seq":case "fade":g=this;for(f=0;f<e.length;f++){h=c.graph.getNode(e[f]);h.setData("alpha",0,"end")}c.fx.animate(i.merge(b,{modes:["node-property:alpha"],onComplete:function(){g.removeNode(e,{type:"nothing"});c.labels.clearLabels();c.reposition();c.fx.animate(i.merge(b,{modes:["linear"]}))}}));
break;case "fade:con":g=this;for(f=0;f<e.length;f++){h=c.graph.getNode(e[f]);h.setData("alpha",0,"end");h.ignore=true}c.reposition();c.fx.animate(i.merge(b,{modes:["node-property:alpha","linear"],onComplete:function(){g.removeNode(e,{type:"nothing"})}}));break;case "iter":g=this;c.fx.sequence({condition:function(){return e.length!=0},step:function(){g.removeNode(e.shift(),{type:"nothing"});c.labels.clearLabels()},onComplete:function(){b.onComplete()},duration:Math.ceil(b.duration/e.length)});break;
default:this.doError()}},removeEdge:function(a,d){var c=this.viz,b=i.merge(this.options,c.controller,d),e=i.type(a[0])=="string"?[a]:a,f,g,h;switch(b.type){case "nothing":for(f=0;f<e.length;f++)c.graph.removeAdjacence(e[f][0],e[f][1]);break;case "replot":this.removeEdge(e,{type:"nothing"});c.refresh(true);break;case "fade:seq":case "fade":g=this;for(f=0;f<e.length;f++)(h=c.graph.getAdjacence(e[f][0],e[f][1]))&&h.setData("alpha",0,"end");c.fx.animate(i.merge(b,{modes:["edge-property:alpha"],onComplete:function(){g.removeEdge(e,
{type:"nothing"});c.reposition();c.fx.animate(i.merge(b,{modes:["linear"]}))}}));break;case "fade:con":g=this;for(f=0;f<e.length;f++)if(h=c.graph.getAdjacence(e[f][0],e[f][1])){h.setData("alpha",0,"end");h.ignore=true}c.reposition();c.fx.animate(i.merge(b,{modes:["edge-property:alpha","linear"],onComplete:function(){g.removeEdge(e,{type:"nothing"})}}));break;case "iter":g=this;c.fx.sequence({condition:function(){return e.length!=0},step:function(){g.removeEdge(e.shift(),{type:"nothing"});c.labels.clearLabels()},
onComplete:function(){b.onComplete()},duration:Math.ceil(b.duration/e.length)});break;default:this.doError()}},sum:function(a,d){var c=this.viz,b=i.merge(this.options,c.controller,d),e=c.root,f;c.root=d.id||c.root;switch(b.type){case "nothing":f=c.construct(a);f.eachNode(function(h){h.eachAdjacency(function(j){c.graph.addAdjacence(j.nodeFrom,j.nodeTo,j.data)})});break;case "replot":c.refresh(true);this.sum(a,{type:"nothing"});c.refresh(true);break;case "fade:seq":case "fade":case "fade:con":that=
this;f=c.construct(a);var g=!this.preprocessSum(f)?["node-property:alpha"]:["node-property:alpha","edge-property:alpha"];c.reposition();if(b.type!="fade:con")c.fx.animate(i.merge(b,{modes:["linear"],onComplete:function(){c.fx.animate(i.merge(b,{modes:g,onComplete:function(){b.onComplete()}}))}}));else{c.graph.eachNode(function(h){if(h.id!=e&&h.pos.getp().equals(F.KER)){h.pos.set(h.endPos);h.startPos.set(h.endPos)}});c.fx.animate(i.merge(b,{modes:["linear"].concat(g)}))}break;default:this.doError()}},
morph:function(a,d,c){var b=this.viz,e=i.merge(this.options,b.controller,d),f=b.root,g;b.root=d.id||b.root;switch(e.type){case "nothing":g=b.construct(a);g.eachNode(function(k){var n=b.graph.hasNode(k.id);k.eachAdjacency(function(m){var o=!!b.graph.getAdjacence(m.nodeFrom.id,m.nodeTo.id);b.graph.addAdjacence(m.nodeFrom,m.nodeTo,m.data);if(o){o=b.graph.getAdjacence(m.nodeFrom.id,m.nodeTo.id);for(var p in m.data||{})o.data[p]=m.data[p]}});if(n){n=b.graph.getNode(k.id);for(var l in k.data||{})n.data[l]=
k.data[l]}});b.graph.eachNode(function(k){k.eachAdjacency(function(n){g.getAdjacence(n.nodeFrom.id,n.nodeTo.id)||b.graph.removeAdjacence(n.nodeFrom.id,n.nodeTo.id)});g.hasNode(k.id)||b.graph.removeNode(k.id)});break;case "replot":b.labels.clearLabels(true);this.morph(a,{type:"nothing"});b.refresh(true);b.refresh(true);break;case "fade:seq":case "fade":case "fade:con":that=this;g=b.construct(a);var h=c&&"node-property"in c&&i.map(i.splat(c["node-property"]),function(k){return"$"+k});b.graph.eachNode(function(k){var n=
g.getNode(k.id);if(n){n=n.data;for(var l in n)if(h&&i.indexOf(h,l)>-1)k.endData[l]=n[l];else k.data[l]=n[l]}else{k.setData("alpha",1);k.setData("alpha",1,"start");k.setData("alpha",0,"end");k.ignore=true}});b.graph.eachNode(function(k){k.ignore||k.eachAdjacency(function(n){if(!(n.nodeFrom.ignore||n.nodeTo.ignore)){var l=g.getNode(n.nodeFrom.id);n=g.getNode(n.nodeTo.id);if(!l.adjacentTo(n)){n=b.graph.getAdjacence(l.id,n.id);j=true;n.setData("alpha",1);n.setData("alpha",1,"start");n.setData("alpha",
0,"end")}}})});var j=this.preprocessSum(g);a=!j?["node-property:alpha"]:["node-property:alpha","edge-property:alpha"];a[0]+=c&&"node-property"in c?":"+i.splat(c["node-property"]).join(":"):"";a[1]=(a[1]||"edge-property:alpha")+(c&&"edge-property"in c?":"+i.splat(c["edge-property"]).join(":"):"");c&&"label-property"in c&&a.push("label-property:"+i.splat(c["label-property"]).join(":"));b.reposition();b.graph.eachNode(function(k){if(k.id!=f&&k.pos.getp().equals(F.KER)){k.pos.set(k.endPos);k.startPos.set(k.endPos)}});
b.fx.animate(i.merge(e,{modes:["polar"].concat(a),onComplete:function(){b.graph.eachNode(function(k){k.ignore&&b.graph.removeNode(k.id)});b.graph.eachNode(function(k){k.eachAdjacency(function(n){n.ignore&&b.graph.removeAdjacence(n.nodeFrom.id,n.nodeTo.id)})});e.onComplete()}}))}},contract:function(a,d){var c=this.viz;if(!(a.collapsed||!a.anySubnode(i.lambda(true)))){d=i.merge(this.options,c.config,d||{},{modes:["node-property:alpha:span","linear"]});a.collapsed=true;(function b(e){e.eachSubnode(function(f){f.ignore=
true;f.setData("alpha",0,d.type=="animate"?"end":"current");b(f)})})(a);if(d.type=="animate"){c.compute("end");c.rotated&&c.rotate(c.rotated,"none",{property:"end"});(function b(e){e.eachSubnode(function(f){f.setPos(a.getPos("end"),"end");b(f)})})(a);c.fx.animate(d)}else d.type=="replot"&&c.refresh()}},expand:function(a,d){if("collapsed"in a){var c=this.viz;d=i.merge(this.options,c.config,d||{},{modes:["node-property:alpha:span","linear"]});delete a.collapsed;(function b(e){e.eachSubnode(function(f){delete f.ignore;
f.setData("alpha",1,d.type=="animate"?"end":"current");b(f)})})(a);if(d.type=="animate"){c.compute("end");c.rotated&&c.rotate(c.rotated,"none",{property:"end"});c.fx.animate(d)}else d.type=="replot"&&c.refresh()}},preprocessSum:function(a){var d=this.viz;a.eachNode(function(b){if(!d.graph.hasNode(b.id)){d.graph.addNode(b);b=d.graph.getNode(b.id);b.setData("alpha",0);b.setData("alpha",0,"start");b.setData("alpha",1,"end")}});var c=false;a.eachNode(function(b){b.eachAdjacency(function(e){var f=d.graph.getNode(e.nodeFrom.id),
g=d.graph.getNode(e.nodeTo.id);if(!f.adjacentTo(g)){e=d.graph.addAdjacence(f,g,e.data);if(f.startAlpha==f.endAlpha&&g.startAlpha==g.endAlpha){c=true;e.setData("alpha",0);e.setData("alpha",0,"start");e.setData("alpha",1,"end")}}})});return c}};var W={none:{render:i.empty,contains:i.lambda(false)},circle:{render:function(a,d,c,b){b=b.getCtx();b.beginPath();b.arc(d.x,d.y,c,0,Math.PI*2,true);b.closePath();b[a]()},contains:function(a,d,c){var b=a.x-d.x;a=a.y-d.y;return b*b+a*a<=c*c}},ellipse:{render:function(a,
d,c,b,e){e=e.getCtx();b/=2;c/=2;e.save();e.scale(c/b,b/c);e.beginPath();e.arc(d.x*(b/c),d.y*(c/b),b,0,Math.PI*2,true);e.closePath();e[a]();e.restore()},contains:function(a,d,c,b){c/=2;b/=2;c=(c+b)/2;b=a.x-d.x;a=a.y-d.y;return b*b+a*a<=c*c}},square:{render:function(a,d,c,b){b.getCtx()[a+"Rect"](d.x-c,d.y-c,2*c,2*c)},contains:function(a,d,c){return Math.abs(d.x-a.x)<=c&&Math.abs(d.y-a.y)<=c}},rectangle:{render:function(a,d,c,b,e){e.getCtx()[a+"Rect"](d.x-c/2,d.y-b/2,c,b)},contains:function(a,d,c,b){return Math.abs(d.x-
a.x)<=c/2&&Math.abs(d.y-a.y)<=b/2}},triangle:{render:function(a,d,c,b){b=b.getCtx();var e=d.x,f=d.y-c,g=e-c;d=d.y+c;c=e+c;b.beginPath();b.moveTo(e,f);b.lineTo(g,d);b.lineTo(c,d);b.closePath();b[a]()},contains:function(a,d,c){return W.circle.contains(a,d,c)}},star:{render:function(a,d,c,b){b=b.getCtx();var e=Math.PI/5;b.save();b.translate(d.x,d.y);b.beginPath();b.moveTo(c,0);for(d=0;d<9;d++){b.rotate(e);d%2==0?b.lineTo(c/0.525731*0.200811,0):b.lineTo(c,0)}b.closePath();b[a]();b.restore()},contains:function(a,
d,c){return W.circle.contains(a,d,c)}}},aa={line:{render:function(a,d,c){c=c.getCtx();c.beginPath();c.moveTo(a.x,a.y);c.lineTo(d.x,d.y);c.stroke()},contains:function(a,d,c,b){var e=Math.min,f=Math.max,g=e(a.x,d.x),h=f(a.x,d.x);e=e(a.y,d.y);f=f(a.y,d.y);if(c.x>=g&&c.x<=h&&c.y>=e&&c.y<=f){if(Math.abs(d.x-a.x)<=b)return true;return Math.abs((d.y-a.y)/(d.x-a.x)*(c.x-a.x)+a.y-c.y)<=b}return false}},arrow:{render:function(a,d,c,b,e){e=e.getCtx();if(b){b=a;a=d;d=b}b=new G(d.x-a.x,d.y-a.y);b.$scale(c/b.norm());
c=new G(d.x-b.x,d.y-b.y);var f=new G(-b.y/2,b.x/2);b=c.add(f);c=c.$add(f.$scale(-1));e.beginPath();e.moveTo(a.x,a.y);e.lineTo(d.x,d.y);e.stroke();e.beginPath();e.moveTo(b.x,b.y);e.lineTo(c.x,c.y);e.lineTo(d.x,d.y);e.closePath();e.fill()},contains:function(a,d,c,b){return aa.line.contains(a,d,c,b)}},hyperline:{render:function(a,d,c,b){function e(g,h){return g<h?g+Math.PI>h?false:true:h+Math.PI>g?true:false}b=b.getCtx();var f=function(g,h){var j=g.x*h.y-g.y*h.x,k=g.squaredNorm(),n=h.squaredNorm();if(j==
0)return{x:0,y:0,ratio:-1};var l=(g.y*n-h.y*k+g.y-h.y)/j;j=(h.x*k-g.x*n+h.x-g.x)/j;k=(l*l+j*j)/4-1;if(k<0)return{x:0,y:0,ratio:-1};k=Math.sqrt(k);return{x:-l/2,y:-j/2,ratio:k>1E3?-1:k,a:l,b:j}}(a,d);if(f.a>1E3||f.b>1E3||f.ratio<0){b.beginPath();b.moveTo(a.x*c,a.y*c);b.lineTo(d.x*c,d.y*c)}else{d=Math.atan2(d.y-f.y,d.x-f.x);a=Math.atan2(a.y-f.y,a.x-f.x);e=e(d,a);b.beginPath();b.arc(f.x*c,f.y*c,f.ratio*c,d,a,e)}b.stroke()},contains:i.lambda(false)}};y.Plot={initialize:function(a,d){this.viz=a;this.config=
a.config;this.node=a.config.Node;this.edge=a.config.Edge;this.animation=new V;this.nodeTypes=new d.Plot.NodeTypes;this.edgeTypes=new d.Plot.EdgeTypes;this.labels=a.labels},nodeHelper:W,edgeHelper:aa,Interpolator:{map:{border:"color",color:"color",width:"number",height:"number",dim:"number",alpha:"number",lineWidth:"number",angularWidth:"number",span:"number",valueArray:"array-number",dimArray:"array-number"},canvas:{globalAlpha:"number",fillStyle:"color",strokeStyle:"color",lineWidth:"number",shadowBlur:"number",
shadowColor:"color",shadowOffsetX:"number",shadowOffsetY:"number",miterLimit:"number"},label:{size:"number",color:"color"},compute:function(a,d,c){return a+(d-a)*c},moebius:function(a,d,c,b){d=b.scale(-c);if(d.norm()<1){c=d.x;b=d.y;var e=a.startPos.getc().moebiusTransformation(d);a.pos.setc(e.x,e.y);d.x=c;d.y=b}},linear:function(a,d,c){d=a.startPos.getc(true);var b=a.endPos.getc(true);a.pos.setc(this.compute(d.x,b.x,c),this.compute(d.y,b.y,c))},polar:function(a,d,c){d=a.startPos.getp(true);c=a.endPos.getp().interpolate(d,
c);a.pos.setp(c.theta,c.rho)},number:function(a,d,c,b,e){var f=a[b](d,"start");b=a[b](d,"end");a[e](d,this.compute(f,b,c))},color:function(a,d,c,b,e){var f=i.hexToRgb(a[b](d,"start"));b=i.hexToRgb(a[b](d,"end"));var g=this.compute;c=i.rgbToHex([parseInt(g(f[0],b[0],c)),parseInt(g(f[1],b[1],c)),parseInt(g(f[2],b[2],c))]);a[e](d,c)},"array-number":function(a,d,c,b,e){var f=a[b](d,"start");b=a[b](d,"end");for(var g=[],h=0,j=f.length;h<j;h++){var k=f[h],n=b[h];if(k.length){for(var l=0,m=k.length,o=[];l<
m;l++)o.push(this.compute(k[l],n[l],c));g.push(o)}else g.push(this.compute(k,n,c))}a[e](d,g)},node:function(a,d,c,b,e,f){b=this[b];if(d)for(var g=d.length,h=0;h<g;h++){var j=d[h];this[b[j]](a,j,c,e,f)}else for(j in b)this[b[j]](a,j,c,e,f)},edge:function(a,d,c,b,e,f){a=a.adjacencies;for(var g in a)this.node(a[g],d,c,b,e,f)},"node-property":function(a,d,c){this.node(a,d,c,"map","getData","setData")},"edge-property":function(a,d,c){this.edge(a,d,c,"map","getData","setData")},"label-property":function(a,
d,c){this.node(a,d,c,"label","getLabelData","setLabelData")},"node-style":function(a,d,c){this.node(a,d,c,"canvas","getCanvasStyle","setCanvasStyle")},"edge-style":function(a,d,c){this.edge(a,d,c,"canvas","getCanvasStyle","setCanvasStyle")}},sequence:function(a){var d=this;a=i.merge({condition:i.lambda(false),step:i.empty,onComplete:i.empty,duration:200},a||{});var c=setInterval(function(){if(a.condition())a.step();else{clearInterval(c);a.onComplete()}d.viz.refresh(true)},a.duration)},prepare:function(a){var d=
this.viz.graph,c={"node-property":{getter:"getData",setter:"setData"},"edge-property":{getter:"getData",setter:"setData"},"node-style":{getter:"getCanvasStyle",setter:"setCanvasStyle"},"edge-style":{getter:"getCanvasStyle",setter:"setCanvasStyle"}},b={};if(i.type(a)=="array")for(var e=0,f=a.length;e<f;e++){var g=a[e].split(":");b[g.shift()]=g}else for(e in a)if(e=="position")b[a.position]=[];else b[e]=i.splat(a[e]);d.eachNode(function(h){h.startPos.set(h.pos);i.each(["node-property","node-style"],
function(j){if(j in b)for(var k=b[j],n=0,l=k.length;n<l;n++)h[c[j].setter](k[n],h[c[j].getter](k[n]),"start")});i.each(["edge-property","edge-style"],function(j){if(j in b){var k=b[j];h.eachAdjacency(function(n){for(var l=0,m=k.length;l<m;l++)n[c[j].setter](k[l],n[c[j].getter](k[l]),"start")})}})});return b},animate:function(a,d){a=i.merge(this.viz.config,a||{});var c=this,b=this.viz.graph,e=this.Interpolator,f=a.type==="nodefx"?this.nodeFxAnimation:this.animation,g=this.prepare(a.modes);a.hideLabels&&
this.labels.hideLabels(true);f.setOptions(i.merge(a,{$animating:false,compute:function(h){b.eachNode(function(j){for(var k in g)e[k](j,g[k],h,d)});c.plot(a,this.$animating,h);this.$animating=true},complete:function(){a.hideLabels&&c.labels.hideLabels(false);c.plot(a);a.onComplete();a.onAfterCompute()}})).start()},nodeFx:function(a){var d=this.viz,c=d.graph,b=this.nodeFxAnimation,e=i.merge(this.viz.config,{elements:{id:false,properties:{}},reposition:false});a=i.merge(e,a||{},{onBeforeCompute:i.empty,
onAfterCompute:i.empty});b.stopTimer();var f=a.elements.properties;if(a.elements.id){b=i.splat(a.elements.id);i.each(b,function(h){if(h=c.getNode(h))for(var j in f)h.setData(j,f[j],"end")})}else c.eachNode(function(h){for(var j in f)h.setData(j,f[j],"end")});b=[];for(var g in f)b.push(g);g=["node-property:"+b.join(":")];if(a.reposition){g.push("linear");d.compute("end")}this.animate(i.merge(a,{modes:g,type:"nodefx"}))},plot:function(a,d){var c=this.viz,b=c.graph,e=c.canvas;c=c.root;var f=this,g=e.getCtx(),
h=Math.min;a=a||this.viz.controller;a.clearCanvas&&e.clear();if(c=b.getNode(c)){var j=!!c.visited;b.eachNode(function(k){var n=k.getData("alpha");k.eachAdjacency(function(l){var m=l.nodeTo;if(!!m.visited===j&&k.drawn&&m.drawn){!d&&a.onBeforePlotLine(l);g.save();g.globalAlpha=h(n,m.getData("alpha"),l.getData("alpha"));f.plotLine(l,e,d);g.restore();!d&&a.onAfterPlotLine(l)}});g.save();if(k.drawn){!d&&a.onBeforePlotNode(k);f.plotNode(k,e,d);!d&&a.onAfterPlotNode(k)}if(!f.labelsHidden&&a.withLabels)k.drawn&&
n>=0.95?f.labels.plotLabel(e,k,a):f.labels.hideLabel(k,false);g.restore();k.visited=!j})}},plotTree:function(a,d,c){var b=this,e=this.viz.canvas,f=e.getCtx(),g=a.getData("alpha");a.eachSubnode(function(h){if(d.plotSubtree(a,h)&&h.exist&&h.drawn){var j=a.getAdjacency(h.id);!c&&d.onBeforePlotLine(j);f.globalAlpha=Math.min(g,h.getData("alpha"));b.plotLine(j,e,c);!c&&d.onAfterPlotLine(j);b.plotTree(h,d,c)}});if(a.drawn){!c&&d.onBeforePlotNode(a);this.plotNode(a,e,c);!c&&d.onAfterPlotNode(a);!d.hideLabels&&
d.withLabels&&g>=0.95?this.labels.plotLabel(e,a,d):this.labels.hideLabel(a,false)}else this.labels.hideLabel(a,true)},plotNode:function(a,d,c){var b=a.getData("type"),e=this.node.CanvasStyles;if(b!="none"){var f=a.getData("lineWidth"),g=a.getData("color"),h=a.getData("alpha"),j=d.getCtx();j.lineWidth=f;j.fillStyle=j.strokeStyle=g;j.globalAlpha=h;for(var k in e)j[k]=a.getCanvasStyle(k);this.nodeTypes[b].render.call(this,a,d,c)}},plotLine:function(a,d,c){var b=a.getData("type"),e=this.edge.CanvasStyles;
if(b!="none"){var f=a.getData("lineWidth"),g=a.getData("color"),h=d.getCtx();h.lineWidth=f;h.fillStyle=h.strokeStyle=g;for(var j in e)h[j]=a.getCanvasStyle(j);this.edgeTypes[b].render.call(this,a,d,c)}}};y.Label={};y.Label.Native=new v({plotLabel:function(a,d,c){var b=a.getCtx();d.pos.getc(true);b.font=d.getLabelData("style")+" "+d.getLabelData("size")+"px "+d.getLabelData("family");b.textAlign=d.getLabelData("textAlign");b.fillStyle=b.strokeStyle=d.getLabelData("color");b.textBaseline=d.getLabelData("textBaseline");
this.renderLabel(a,d,c)},renderLabel:function(a,d){var c=a.getCtx(),b=d.pos.getc(true);c.fillText(d.name,b.x,b.y+d.getData("height")/2)},hideLabel:i.empty,hideLabels:i.empty});y.Label.DOM=new v({labelsHidden:false,labelContainer:false,labels:{},getLabelContainer:function(){return this.labelContainer?this.labelContainer:this.labelContainer=document.getElementById(this.viz.config.labelContainer)},getLabel:function(a){return a in this.labels&&this.labels[a]!=null?this.labels[a]:this.labels[a]=document.getElementById(a)},
hideLabels:function(a){this.getLabelContainer().style.display=a?"none":"";this.labelsHidden=a},clearLabels:function(a){for(var d in this.labels)if(a||!this.viz.graph.hasNode(d)){this.disposeLabel(d);delete this.labels[d]}},disposeLabel:function(a){(a=this.getLabel(a))&&a.parentNode&&a.parentNode.removeChild(a)},hideLabel:function(a,d){a=i.splat(a);var c=d?"":"none",b=this;i.each(a,function(e){if(e=b.getLabel(e.id))e.style.display=c})},fitsInCanvas:function(a,d){var c=d.getSize();if(a.x>=c.width||
a.x<0||a.y>=c.height||a.y<0)return false;return true}});y.Label.HTML=new v({Implements:y.Label.DOM,plotLabel:function(a,d,c){a=d.id;var b=this.getLabel(a);if(!b&&!(b=document.getElementById(a))){b=document.createElement("div");var e=this.getLabelContainer();b.id=a;b.className="node";b.style.position="absolute";c.onCreateLabel(b,d);e.appendChild(b);this.labels[d.id]=b}this.placeLabel(b,d,c)}});y.Label.SVG=new v({Implements:y.Label.DOM,plotLabel:function(a,d,c){a=d.id;var b=this.getLabel(a);if(!b&&
!(b=document.getElementById(a))){b=document.createElementNS("http://www.w3.org/2000/svg","svg:text");var e=document.createElementNS("http://www.w3.org/2000/svg","svg:tspan");b.appendChild(e);e=this.getLabelContainer();b.setAttribute("id",a);b.setAttribute("class","node");e.appendChild(b);c.onCreateLabel(b,d);this.labels[d.id]=b}this.placeLabel(b,d,c)}});y.Geom=new v({initialize:function(a){this.viz=a;this.config=a.config;this.node=a.config.Node;this.edge=a.config.Edge},translate:function(a,d){d=i.splat(d);
this.viz.graph.eachNode(function(c){i.each(d,function(b){c.getPos(b).$add(a)})})},setRightLevelToShow:function(a,d,c){var b=this.getRightLevelToShow(a,d),e=this.viz.labels,f=i.merge({execShow:true,execHide:true,onHide:i.empty,onShow:i.empty},c||{});a.eachLevel(0,this.config.levelsToShow,function(g){if(g._depth-a._depth>b){f.onHide(g);if(f.execHide){g.drawn=false;g.exist=false;e.hideLabel(g,false)}}else{f.onShow(g);if(f.execShow)g.exist=true}});a.drawn=true},getRightLevelToShow:function(a,d){var c=
this.config,b=c.levelsToShow;if(!c.constrained)return b;for(;!this.treeFitsInCanvas(a,d,b)&&b>1;)b--;return b}});var X={construct:function(a){var d=i.type(a)=="array",c=new y(this.graphOptions,this.config.Node,this.config.Edge,this.config.Label);d?function(b,e){for(var f=function(o){for(var p=0,q=e.length;p<q;p++)if(e[p].id==o)return e[p];return b.addNode({id:o,name:o})},g=0,h=e.length;g<h;g++){b.addNode(e[g]);var j=e[g].adjacencies;if(j)for(var k=0,n=j.length;k<n;k++){var l=j[k],m={};if(typeof j[k]!=
"string"){m=i.merge(l.data,{});l=l.nodeTo}b.addAdjacence(e[g],f(l),m)}}}(c,a):function(b,e){b.addNode(e);if(e.children)for(var f=0,g=e.children;f<g.length;f++){b.addAdjacence(e,g[f]);arguments.callee(b,g[f])}}(c,a);return c},loadJSON:function(a,d){this.json=a;this.labels&&this.labels.clearLabels&&this.labels.clearLabels(true);this.graph=this.construct(a);this.root=i.type(a)!="array"?a.id:a[d?d:0].id},toJSON:function(a){a=a||"tree";if(a=="tree"){var d={};d=function b(e){var f={};f.id=e.id;f.name=e.name;
f.data=e.data;var g=[];e.eachSubnode(function(h){g.push(b(h))});f.children=g;return f}(this.graph.getNode(this.root))}else{d=[];var c=!!this.graph.getNode(this.root).visited;this.graph.eachNode(function(b){var e={};e.id=b.id;e.name=b.name;e.data=b.data;var f=[];b.eachAdjacency(function(g){var h=g.nodeTo;if(!!h.visited===c){var j={};j.nodeTo=h.id;j.data=g.data;f.push(j)}});e.adjacencies=f;d.push(e);b.visited=!c})}return d}},Q=$jit.Layouts={},ba={label:null,compute:function(a,d,c){this.initializeLabel(c);
var b=this.label,e=b.style;a.eachNode(function(f){var g=f.getData("autoWidth"),h=f.getData("autoHeight");if(g||h){delete f.data.$width;delete f.data.$height;delete f.data.$dim;var j=f.getData("width"),k=f.getData("height");e.width=g?"auto":j+"px";e.height=h?"auto":k+"px";b.innerHTML=f.name;g=b.offsetWidth;h=b.offsetHeight;j=f.getData("type");if(i.indexOf(["circle","square","triangle","star"],j)===-1){f.setData("width",g);f.setData("height",h)}else{g=g>h?g:h;f.setData("width",g);f.setData("height",
g);f.setData("dim",g)}}})},initializeLabel:function(a){if(!this.label){this.label=document.createElement("div");document.body.appendChild(this.label)}this.setLabelStyles(a)},setLabelStyles:function(){i.extend(this.label.style,{visibility:"hidden",position:"absolute",width:"auto",height:"auto"});this.label.className="jit-autoadjust-label"}};Q.Tree=function(){function a(l,m,o,p,q){var t=m.Node,x=m.multitree;if(t.overridable){var r=-1,w=-1;l.eachNode(function(s){if(s._depth==o&&(!x||"$orn"in s.data&&
s.data.$orn==p)){var z=s.getData("width",q);s=s.getData("height",q);r=r<z?z:r;w=w<s?s:w}});return{width:r<0?t.width:r,height:w<0?t.height:w}}else return t}function d(l,m,o,p){p=p=="left"||p=="right"?"y":"x";l.getPos(m)[p]+=o}function c(l,m){var o=[];i.each(l,function(p){p=n.call(p);p[0]+=m;p[1]+=m;o.push(p)});return o}function b(l,m){if(l.length==0)return m;if(m.length==0)return l;var o=l.shift(),p=m.shift();return[[o[0],p[1]]].concat(b(l,m))}function e(l,m){m=m||[];if(l.length==0)return m;var o=
l.pop();return e(l,b(o,m))}function f(l,m,o,p,q){if(l.length<=q||m.length<=q)return 0;var t=l[q][1],x=m[q][0];return Math.max(f(l,m,o,p,++q)+o,t-x+p)}function g(l,m,o){function p(q,t,x){if(t.length<=x)return[];var r=t[x],w=f(q,r,m,o,0);return[w].concat(p(b(q,c(r,w)),t,++x))}return p([],l,0)}function h(l,m,o){function p(q,t,x){if(t.length<=x)return[];var r=t[x],w=-f(r,q,m,o,0);return[w].concat(p(b(c(r,w),q),t,++x))}l=n.call(l);return p([],l.reverse(),0).reverse()}function j(l,m,o,p){var q=g(l,m,o);
l=h(l,m,o);if(p=="left")l=q;else if(p=="right")q=l;p=0;for(m=[];p<q.length;p++)m[p]=(q[p]+l[p])/2;return m}function k(l,m,o,p,q){function t(J,H,N){var U=J.getData(C,o),Y=[],Z=[],$=false,ea=(H||J.getData(B,o))+p.levelDistance;J.eachSubnode(function(M){if(M.exist&&(!x||"$orn"in M.data&&M.data.$orn==q)){$||($=a(l,p,M._depth,q,o));M=t(M,$[B],N+ea);Y.push(M.tree);Z.push(M.extent)}});H=j(Z,D,A,I);for(var O=0,ca=[];O<Y.length;O++){d(Y[O],o,H[O],q);ca.push(c(Z[O],H[O]))}U=[[-U/2,U/2]].concat(e(ca));J.getPos(o)[z]=
0;if(q=="top"||q=="left")J.getPos(o)[u]=N;else J.getPos(o)[u]=-N;return{tree:J,extent:U}}var x=p.multitree,r=["x","y"],w=["width","height"],s=+(q=="left"||q=="right"),z=r[s],u=r[1-s],C=w[s],B=w[1-s],A=p.siblingOffset,D=p.subtreeOffset,I=p.align;t(m,false,0)}var n=Array.prototype.slice;return new v({compute:function(l,m){var o=l||"start",p=this.graph.getNode(this.root);i.extend(p,{drawn:true,exist:true,selected:true});ba.compute(this.graph,o,this.config);if(m||!("_depth"in p))this.graph.computeLevels(this.root,
0,"ignore");this.computePositions(p,o)},computePositions:function(l,m){var o=this.config,p=o.multitree,q=o.align,t=q!=="center"&&o.indent;o=o.orientation;var x=this;i.each(p?["top","right","bottom","left"]:[o],function(r){k(x.graph,l,m,x.config,r,m);var w=["x","y"][+(r=="left"||r=="right")];(function s(z){z.eachSubnode(function(u){if(u.exist&&(!p||"$orn"in u.data&&u.data.$orn==r)){u.getPos(m)[w]+=z.getPos(m)[w];if(t)u.getPos(m)[w]+=q=="left"?t:-t;s(u)}})})(l)})}})}();$jit.ST=function(){function a(b){b=
b||this.clickedNode;if(!this.config.constrained)return[];var e=this.geom,f=this.canvas,g=b._depth,h=[];this.graph.eachNode(function(j){if(j.exist&&!j.selected)if(j.isDescendantOf(b.id))j._depth<=g&&h.push(j);else h.push(j)});e=e.getRightLevelToShow(b,f);b.eachLevel(e,e,function(j){j.exist&&!j.selected&&h.push(j)});for(e=0;e<c.length;e++){f=this.graph.getNode(c[e]);f.isDescendantOf(b.id)||h.push(f)}return h}function d(){var b=[],e=this.config;this.clickedNode.eachLevel(0,e.levelsToShow,function(f){if(e.multitree&&
!("$orn"in f.data)&&f.anySubnode(function(g){return g.exist&&!g.drawn}))b.push(f);else f.drawn&&!f.anySubnode("drawn")&&b.push(f)});return b}var c=[];return new v({Implements:[X,L,Q.Tree],initialize:function(b){var e=$jit.ST;b=this.controller=this.config=i.merge(E("Canvas","Fx","Tree","Node","Edge","Controller","Tips","NodeStyles","Events","Navigation","Label"),{levelsToShow:2,levelDistance:30,constrained:true,Node:{type:"rectangle"},duration:700,offsetX:0,offsetY:0},b);if(b.useCanvas){this.canvas=
b.useCanvas;this.config.labelContainer=this.canvas.id+"-label"}else{if(b.background)b.background=i.merge({type:"Circles"},b.background);this.canvas=new K(this,b);this.config.labelContainer=(typeof b.injectInto=="string"?b.injectInto:b.injectInto.id)+"-label"}this.graphOptions={complex:true};this.graph=new y(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new e.Label[b.Label.type](this);this.fx=new e.Plot(this,e);this.op=new e.Op(this);this.group=new e.Group(this);this.geom=new e.Geom(this);
this.clickedNode=null;this.initializeExtras()},plot:function(){this.fx.plot(this.controller)},switchPosition:function(b,e,f){var g=this.geom,h=this.fx,j=this;if(!h.busy){h.busy=true;this.contract({onComplete:function(){g.switchOrientation(b);j.compute("end",false);h.busy=false;if(e=="animate")j.onClick(j.clickedNode.id,f);else e=="replot"&&j.select(j.clickedNode.id,f)}},b)}},switchAlignment:function(b,e,f){this.config.align=b;if(e=="animate")this.select(this.clickedNode.id,f);else e=="replot"&&this.onClick(this.clickedNode.id,
f)},addNodeInPath:function(b){c.push(b);this.select(this.clickedNode&&this.clickedNode.id||this.root)},clearNodesInPath:function(){c.length=0;this.select(this.clickedNode&&this.clickedNode.id||this.root)},refresh:function(){this.reposition();this.select(this.clickedNode&&this.clickedNode.id||this.root)},reposition:function(){this.graph.computeLevels(this.root,0,"ignore");this.geom.setRightLevelToShow(this.clickedNode,this.canvas);this.graph.eachNode(function(b){if(b.exist)b.drawn=true});this.compute("end")},
requestNodes:function(b,e){var f=i.merge(this.controller,e),g=this.config.levelsToShow;if(f.request){var h=[],j=b._depth;b.eachLevel(0,g,function(k){if(k.drawn&&!k.anySubnode()){h.push(k);k._level=g-(k._depth-j)}});this.group.requestNodes(h,f)}else f.onComplete()},contract:function(b,e){var f=this.config.orientation,g=this.geom,h=this.group;e&&g.switchOrientation(e);var j=a.call(this);e&&g.switchOrientation(f);h.contract(j,i.merge(this.controller,b))},move:function(b,e){this.compute("end",false);
var f=e.Move,g={x:f.offsetX,y:f.offsetY};f.enable&&this.geom.translate(b.endPos.add(g).$scale(-1),"end");this.fx.animate(i.merge(this.controller,{modes:["linear"]},e))},expand:function(b,e){this.group.expand(d.call(this,b),i.merge(this.controller,e))},selectPath:function(b){function e(h){if(!(h==null||h.selected)){h.selected=true;i.each(f.group.getSiblings([h])[h.id],function(j){j.exist=true;j.drawn=true});h=h.getParents();h=h.length>0?h[0]:null;e(h)}}var f=this;this.graph.eachNode(function(h){h.selected=
false});var g=0;for(b=[b.id].concat(c);g<b.length;g++)e(this.graph.getNode(b[g]))},setRoot:function(b,e,f){function g(){if(this.config.multitree&&n.data.$orn){var l={left:"right",right:"left",top:"bottom",bottom:"top"}[n.data.$orn];k.data.$orn=l;(function m(o){o.eachSubnode(function(p){if(p.id!=b){p.data.$orn=l;m(p)}})})(k);delete n.data.$orn}this.root=b;this.clickedNode=n;this.graph.computeLevels(this.root,0,"ignore");this.geom.setRightLevelToShow(n,j,{execHide:false,onShow:function(m){if(!m.drawn){m.drawn=
true;m.setData("alpha",1,"end");m.setData("alpha",0);m.pos.setc(n.pos.x,n.pos.y)}}});this.compute("end");this.busy=true;this.fx.animate({modes:["linear","node-property:alpha"],onComplete:function(){h.busy=false;h.onClick(b,{onComplete:function(){f&&f.onComplete()}})}})}if(!this.busy){this.busy=true;var h=this,j=this.canvas,k=this.graph.getNode(this.root),n=this.graph.getNode(b);delete k.data.$orns;if(e=="animate"){g.call(this);h.selectPath(n)}else if(e=="replot"){g.call(this);this.select(this.root)}}},
addSubtree:function(b,e,f){if(e=="replot")this.op.sum(b,i.extend({type:"replot"},f||{}));else if(e=="animate")this.op.sum(b,i.extend({type:"fade:seq"},f||{}))},removeSubtree:function(b,e,f,g){var h=[];this.graph.getNode(b).eachLevel(+!e,false,function(j){h.push(j.id)});if(f=="replot")this.op.removeNode(h,i.extend({type:"replot"},g||{}));else if(f=="animate")this.op.removeNode(h,i.extend({type:"fade:seq"},g||{}))},select:function(b,e){var f=this.group,g=this.geom,h=this.graph.getNode(b),j=this.canvas;
this.graph.getNode(this.root);var k=i.merge(this.controller,e),n=this;k.onBeforeCompute(h);this.selectPath(h);this.clickedNode=h;this.requestNodes(h,{onComplete:function(){f.hide(f.prepare(a.call(n)),k);g.setRightLevelToShow(h,j);n.compute("current");n.graph.eachNode(function(l){var m=l.pos.getc(true);l.startPos.setc(m.x,m.y);l.endPos.setc(m.x,m.y);l.visited=false});n.geom.translate(h.endPos.add({x:k.offsetX,y:k.offsetY}).$scale(-1),["start","current","end"]);f.show(d.call(n));n.plot();k.onAfterCompute(n.clickedNode);
k.onComplete()}})},onClick:function(b,e){var f=this.canvas,g=this,h=this.geom,j=this.config,k=i.merge(this.controller,{Move:{enable:true,offsetX:j.offsetX||0,offsetY:j.offsetY||0},setRightLevelToShowConfig:false,onBeforeRequest:i.empty,onBeforeContract:i.empty,onBeforeMove:i.empty,onBeforeExpand:i.empty},e);if(!this.busy){this.busy=true;var n=this.graph.getNode(b);this.selectPath(n,this.clickedNode);this.clickedNode=n;k.onBeforeCompute(n);k.onBeforeRequest(n);this.requestNodes(n,{onComplete:function(){k.onBeforeContract(n);
g.contract({onComplete:function(){h.setRightLevelToShow(n,f,k.setRightLevelToShowConfig);k.onBeforeMove(n);g.move(n,{Move:k.Move,onComplete:function(){k.onBeforeExpand(n);g.expand(n,{onComplete:function(){g.busy=false;k.onAfterCompute(b);k.onComplete()}})}})}})}})}}})}();$jit.ST.$extend=true;$jit.ST.Op=new v({Implements:y.Op});$jit.ST.Group=new v({initialize:function(a){this.viz=a;this.canvas=a.canvas;this.config=a.config;this.animation=new V;this.nodes=null},requestNodes:function(a,d){var c=0,b=
a.length,e=this.viz;b==0&&d.onComplete();for(var f=0;f<b;f++)d.request(a[f].id,a[f]._level,{onComplete:function(g,h){if(h&&h.children){h.id=g;e.op.sum(h,{type:"nothing"})}if(++c==b){e.graph.computeLevels(e.root,0);d.onComplete()}}})},contract:function(a,d){var c=this;a=this.prepare(a);this.animation.setOptions(i.merge(d,{$animating:false,compute:function(b){if(b==1)b=0.99;c.plotStep(1-b,d,this.$animating);this.$animating="contract"},complete:function(){c.hide(a,d)}})).start()},hide:function(a,d){for(var c=
0;c<a.length;c++)a[c].eachLevel(1,false,function(b){b.exist&&i.extend(b,{drawn:false,exist:false})});d.onComplete()},expand:function(a,d){var c=this;this.show(a);this.animation.setOptions(i.merge(d,{$animating:false,compute:function(b){c.plotStep(b,d,this.$animating);this.$animating="expand"},complete:function(){c.plotStep(undefined,d,false);d.onComplete()}})).start()},show:function(a){var d=this.config;this.prepare(a);i.each(a,function(c){if(d.multitree&&!("$orn"in c.data)){delete c.data.$orns;var b=
" ";c.eachSubnode(function(e){if("$orn"in e.data&&b.indexOf(e.data.$orn)<0&&e.exist&&!e.drawn)b+=e.data.$orn+" "});c.data.$orns=b}c.eachLevel(0,d.levelsToShow,function(e){if(e.exist)e.drawn=true})})},prepare:function(a){return this.nodes=this.getNodesWithChildren(a)},getNodesWithChildren:function(a){var d=[],c=this.config;a.sort(function(g,h){return(g._depth<=h._depth)-(g._depth>=h._depth)});for(var b=0;b<a.length;b++)if(a[b].anySubnode("exist")){for(var e=b+1,f=false;!f&&e<a.length;e++)if(!c.multitree||
"$orn"in a[e].data)f=f||a[b].isDescendantOf(a[e].id);f||d.push(a[b])}return d},plotStep:function(a,d,c){var b=this.viz,e=this.config,f=b.canvas.getCtx(),g=this.nodes,h,j,k={};for(h=0;h<g.length;h++){j=g[h];k[j.id]=[];var n=e.multitree&&!("$orn"in j.data),l=n&&j.data.$orns;j.eachSubgraph(function(m){if(n&&l&&l.indexOf(m.data.$orn)>0&&m.drawn){m.drawn=false;k[j.id].push(m)}else if((!n||!l)&&m.drawn){m.drawn=false;k[j.id].push(m)}});j.drawn=true}g.length>0&&b.fx.plot();for(h in k)i.each(k[h],function(m){m.drawn=
true});for(h=0;h<g.length;h++){j=g[h];f.save();b.fx.plotSubtree(j,d,a,c);f.restore()}},getSiblings:function(a){var d={};i.each(a,function(c){var b=c.getParents();if(b.length==0)d[c.id]=[c];else{var e=[];b[0].eachSubnode(function(f){e.push(f)});d[c.id]=e}});return d}});$jit.ST.Geom=new v({Implements:y.Geom,switchOrientation:function(a){this.config.orientation=a},dispatch:function(){var a=Array.prototype.slice.call(arguments),d=a.shift(),c=a.length,b=function(e){return typeof e=="function"?e():e};if(c==
2)return d=="top"||d=="bottom"?b(a[0]):b(a[1]);else if(c==4)switch(d){case "top":return b(a[0]);case "right":return b(a[1]);case "bottom":return b(a[2]);case "left":return b(a[3])}},getSize:function(a,d){var c=a.data,b=this.config,e=b.siblingOffset;c=b.multitree&&"$orn"in c&&c.$orn||b.orientation;b=a.getData("width")+e;e=a.getData("height")+e;return d?this.dispatch(c,b,e):this.dispatch(c,e,b)},getTreeBaseSize:function(a,d,c){var b=this.getSize(a,true),e=0,f=this;if(c(d,a))return b;if(d===0)return 0;
a.eachSubnode(function(g){e+=f.getTreeBaseSize(g,d-1,c)});return(b>e?b:e)+this.config.subtreeOffset},getEdge:function(a,d,c){var b=function(h,j){return function(){return a.pos.add(new G(h,j))}},e=this.node,f=a.getData("width"),g=a.getData("height");if(d=="begin")if(e.align=="center")return this.dispatch(c,b(0,g/2),b(-f/2,0),b(0,-g/2),b(f/2,0));else if(e.align=="left")return this.dispatch(c,b(0,g),b(0,0),b(0,0),b(f,0));else if(e.align=="right")return this.dispatch(c,b(0,0),b(-f,0),b(0,-g),b(0,0));
else throw"align: not implemented";else if(d=="end")if(e.align=="center")return this.dispatch(c,b(0,-g/2),b(f/2,0),b(0,g/2),b(-f/2,0));else if(e.align=="left")return this.dispatch(c,b(0,0),b(f,0),b(0,g),b(0,0));else if(e.align=="right")return this.dispatch(c,b(0,-g),b(0,0),b(0,0),b(-f,0));else throw"align: not implemented";},getScaledTreePosition:function(a,d){var c=this.node,b=a.getData("width"),e=a.getData("height"),f=this.config.multitree&&"$orn"in a.data&&a.data.$orn||this.config.orientation,
g=function(h,j){return function(){return a.pos.add(new G(h,j)).$scale(1-d)}};if(c.align=="left")return this.dispatch(f,g(0,e),g(0,0),g(0,0),g(b,0));else if(c.align=="center")return this.dispatch(f,g(0,e/2),g(-b/2,0),g(0,-e/2),g(b/2,0));else if(c.align=="right")return this.dispatch(f,g(0,0),g(-b,0),g(0,-e),g(0,0));else throw"align: not implemented";},treeFitsInCanvas:function(a,d,c){d=d.getSize();d=this.dispatch(this.config.multitree&&"$orn"in a.data&&a.data.$orn||this.config.orientation,d.width,d.height);
return this.getTreeBaseSize(a,c,function(b,e){return b===0||!e.anySubnode()})<d}});$jit.ST.Plot=new v({Implements:y.Plot,plotSubtree:function(a,d,c,b){var e=this.viz,f=e.canvas,g=e.config;c=Math.min(Math.max(0.0010,c),1);if(c>=0){a.drawn=false;f=f.getCtx();e=e.geom.getScaledTreePosition(a,c);f.translate(e.x,e.y);f.scale(c,c)}this.plotTree(a,i.merge(d,{withLabels:true,hideLabels:!!c,plotSubtree:function(){var h=g.multitree&&!("$orn"in a.data),j=h&&a.getData("orns");return!h||j.indexOf(elem.getData("orn"))>
-1}}),b);if(c>=0)a.drawn=true},getAlignedPos:function(a,d,c){var b=this.node;if(b.align=="center")a={x:a.x-d/2,y:a.y-c/2};else if(b.align=="left"){b=this.config.orientation;a=b=="bottom"||b=="top"?{x:a.x-d/2,y:a.y}:{x:a.x,y:a.y-c/2}}else if(b.align=="right"){b=this.config.orientation;a=b=="bottom"||b=="top"?{x:a.x-d/2,y:a.y-c}:{x:a.x-d,y:a.y-c/2}}else throw"align: not implemented";return a},getOrientation:function(a){var d=this.config,c=d.orientation;if(d.multitree){d=a.nodeFrom;a=a.nodeTo;c="$orn"in
d.data&&d.data.$orn||"$orn"in a.data&&a.data.$orn}return c}});$jit.ST.Label={};$jit.ST.Label.Native=new v({Implements:y.Label.Native,renderLabel:function(a,d){var c=a.getCtx(),b=d.pos.getc(true);c.fillText(d.name,b.x,b.y)}});$jit.ST.Label.DOM=new v({Implements:y.Label.DOM,placeLabel:function(a,d,c){var b=d.pos.getc(true),e=this.viz.config,f=e.Node,g=this.viz.canvas,h=d.getData("width"),j=d.getData("height"),k=g.getSize(),n=b.x*g.scaleOffsetX+g.translateOffsetX;b=b.y*g.scaleOffsetY+g.translateOffsetY;
if(f.align=="center")h={x:Math.round(n-h/2+k.width/2),y:Math.round(b-j/2+k.height/2)};else if(f.align=="left"){e=e.orientation;h=e=="bottom"||e=="top"?{x:Math.round(n-h/2+k.width/2),y:Math.round(b+k.height/2)}:{x:Math.round(n+k.width/2),y:Math.round(b-j/2+k.height/2)}}else if(f.align=="right"){e=e.orientation;h=e=="bottom"||e=="top"?{x:Math.round(n-h/2+k.width/2),y:Math.round(b-j+k.height/2)}:{x:Math.round(n-h+k.width/2),y:Math.round(b-j/2+k.height/2)}}else throw"align: not implemented";j=a.style;
j.left=h.x+"px";j.top=h.y+"px";j.display=this.fitsInCanvas(h,g)?"":"none";c.onPlaceLabel(a,d)}});$jit.ST.Label.SVG=new v({Implements:[$jit.ST.Label.DOM,y.Label.SVG],initialize:function(a){this.viz=a}});$jit.ST.Label.HTML=new v({Implements:[$jit.ST.Label.DOM,y.Label.HTML],initialize:function(a){this.viz=a}});$jit.ST.Plot.NodeTypes=new v({none:{render:i.empty,contains:i.lambda(false)},circle:{render:function(a,d){var c=a.getData("dim"),b=this.getAlignedPos(a.pos.getc(true),c,c);c=c/2;this.nodeHelper.circle.render("fill",
{x:b.x+c,y:b.y+c},c,d)},contains:function(a){var d=a.getData("dim");a=this.getAlignedPos(a.pos.getc(true),d,d);d=d/2;this.nodeHelper.circle.contains({x:a.x+d,y:a.y+d},d)}},square:{render:function(a,d){var c=a.getData("dim"),b=c/2;c=this.getAlignedPos(a.pos.getc(true),c,c);this.nodeHelper.square.render("fill",{x:c.x+b,y:c.y+b},b,d)},contains:function(a){var d=a.getData("dim");a=this.getAlignedPos(a.pos.getc(true),d,d);d=d/2;this.nodeHelper.square.contains({x:a.x+d,y:a.y+d},d)}},ellipse:{render:function(a,
d){var c=a.getData("width"),b=a.getData("height"),e=this.getAlignedPos(a.pos.getc(true),c,b);this.nodeHelper.ellipse.render("fill",{x:e.x+c/2,y:e.y+b/2},c,b,d)},contains:function(a){var d=a.getData("width"),c=a.getData("height");a=this.getAlignedPos(a.pos.getc(true),d,c);this.nodeHelper.ellipse.contains({x:a.x+d/2,y:a.y+c/2},d,c,canvas)}},rectangle:{render:function(a,d){var c=a.getData("width"),b=a.getData("height"),e=this.getAlignedPos(a.pos.getc(true),c,b);this.nodeHelper.rectangle.render("fill",
{x:e.x+c/2,y:e.y+b/2},c,b,d)},contains:function(a){var d=a.getData("width"),c=a.getData("height");a=this.getAlignedPos(a.pos.getc(true),d,c);this.nodeHelper.rectangle.contains({x:a.x+d/2,y:a.y+c/2},d,c,canvas)}}});$jit.ST.Plot.EdgeTypes=new v({none:i.empty,line:{render:function(a,d){var c=this.getOrientation(a),b=a.nodeFrom,e=a.nodeTo,f=b._depth<e._depth,g=this.viz.geom.getEdge(f?b:e,"begin",c);c=this.viz.geom.getEdge(f?e:b,"end",c);this.edgeHelper.line.render(g,c,d)},contains:function(a,d){var c=
this.getOrientation(a),b=a.nodeFrom,e=a.nodeTo,f=b._depth<e._depth,g=this.viz.geom.getEdge(f?b:e,"begin",c);c=this.viz.geom.getEdge(f?e:b,"end",c);return this.edgeHelper.line.contains(g,c,d,this.edge.epsilon)}},arrow:{render:function(a,d){var c=this.getOrientation(a),b=a.nodeFrom,e=a.nodeTo,f=a.getData("dim"),g=this.viz.geom.getEdge(b,"begin",c);c=this.viz.geom.getEdge(e,"end",c);e=a.data.$direction;this.edgeHelper.arrow.render(g,c,f,e&&e.length>1&&e[0]!=b.id,d)},contains:function(a,d){var c=this.getOrientation(a),
b=a.nodeFrom,e=a.nodeTo,f=b._depth<e._depth,g=this.viz.geom.getEdge(f?b:e,"begin",c);c=this.viz.geom.getEdge(f?e:b,"end",c);return this.edgeHelper.arrow.contains(g,c,d,this.edge.epsilon)}},"quadratic:begin":{render:function(a,d){var c=this.getOrientation(a),b=a.nodeFrom,e=a.nodeTo,f=b._depth<e._depth,g=this.viz.geom.getEdge(f?b:e,"begin",c);b=this.viz.geom.getEdge(f?e:b,"end",c);e=a.getData("dim");f=d.getCtx();f.beginPath();f.moveTo(g.x,g.y);switch(c){case "left":f.quadraticCurveTo(g.x+e,g.y,b.x,
b.y);break;case "right":f.quadraticCurveTo(g.x-e,g.y,b.x,b.y);break;case "top":f.quadraticCurveTo(g.x,g.y+e,b.x,b.y);break;case "bottom":f.quadraticCurveTo(g.x,g.y-e,b.x,b.y)}f.stroke()}},"quadratic:end":{render:function(a,d){var c=this.getOrientation(a),b=a.nodeFrom,e=a.nodeTo,f=b._depth<e._depth,g=this.viz.geom.getEdge(f?b:e,"begin",c);b=this.viz.geom.getEdge(f?e:b,"end",c);e=a.getData("dim");f=d.getCtx();f.beginPath();f.moveTo(g.x,g.y);switch(c){case "left":f.quadraticCurveTo(b.x-e,b.y,b.x,b.y);
break;case "right":f.quadraticCurveTo(b.x+e,b.y,b.x,b.y);break;case "top":f.quadraticCurveTo(b.x,b.y-e,b.x,b.y);break;case "bottom":f.quadraticCurveTo(b.x,b.y+e,b.x,b.y)}f.stroke()}},bezier:{render:function(a,d){var c=this.getOrientation(a),b=a.nodeFrom,e=a.nodeTo,f=b._depth<e._depth,g=this.viz.geom.getEdge(f?b:e,"begin",c);b=this.viz.geom.getEdge(f?e:b,"end",c);e=a.getData("dim");f=d.getCtx();f.beginPath();f.moveTo(g.x,g.y);switch(c){case "left":f.bezierCurveTo(g.x+e,g.y,b.x-e,b.y,b.x,b.y);break;
case "right":f.bezierCurveTo(g.x-e,g.y,b.x+e,b.y,b.x,b.y);break;case "top":f.bezierCurveTo(g.x,g.y+e,b.x,b.y-e,b.x,b.y);break;case "bottom":f.bezierCurveTo(g.x,g.y-e,b.x,b.y+e,b.x,b.y)}f.stroke()}}});$jit.ST.Plot.NodeTypes.implement({"areachart-stacked":{render:function(a,d){var c=a.pos.getc(true),b=a.getData("width"),e=a.getData("height");e=this.getAlignedPos(c,b,e);c=e.x;e=e.y;var f=a.getData("stringArray"),g=a.getData("dimArray"),h=a.getData("valueArray"),j=i.reduce(h,function(H,N){return H+N[0]},
0),k=i.reduce(h,function(H,N){return H+N[1]},0),n=a.getData("colorArray"),l=n.length,m=a.getData("config"),o=a.getData("gradient"),p=m.showLabels,q=m.showAggregates,t=m.Label,x=a.getData("prev"),r=d.getCtx(),w=a.getData("border");if(n&&g&&f){for(var s=0,z=g.length,u=0,C=0,B=0;s<z;s++){r.fillStyle=r.strokeStyle=n[s%l];r.save();if(o&&(g[s][0]>0||g[s][1]>0)){var A=u+g[s][0],D=C+g[s][1],I=Math.atan((D-A)/b);D=r.createLinearGradient(c+b/2,e-(A+D)/2,c+b/2+55*Math.sin(I),e-(A+D)/2+55*Math.cos(I));A=i.rgbToHex(i.map(i.hexToRgb(n[s%
l].slice(1)),function(H){return H*0.85>>0}));D.addColorStop(0,n[s%l]);D.addColorStop(1,A);r.fillStyle=D}r.beginPath();r.moveTo(c,e-u);r.lineTo(c+b,e-C);r.lineTo(c+b,e-C-g[s][1]);r.lineTo(c,e-u-g[s][0]);r.lineTo(c,e-u);r.fill();r.restore();if(w){var J=(D=w.name==f[s])?0.7:0.8;A=i.rgbToHex(i.map(i.hexToRgb(n[s%l].slice(1)),function(H){return H*J>>0}));r.strokeStyle=A;r.lineWidth=D?4:1;r.save();r.beginPath();if(w.index===0){r.moveTo(c,e-u);r.lineTo(c,e-u-g[s][0])}else{r.moveTo(c+b,e-C);r.lineTo(c+b,
e-C-g[s][1])}r.stroke();r.restore()}u+=g[s][0]||0;C+=g[s][1]||0;if(g[s][0]>0)B+=h[s][0]||0}if(x&&t.type=="Native"){r.save();r.beginPath();r.fillStyle=r.strokeStyle=t.color;r.font=t.style+" "+t.size+"px "+t.family;r.textAlign="center";r.textBaseline="middle";q(a.name,j,k,a)&&r.fillText(B,c,e-u-m.labelOffset-t.size/2,b);p(a.name,j,k,a)&&r.fillText(a.name,c,e+t.size/2+m.labelOffset);r.restore()}}},contains:function(a,d){var c=a.pos.getc(true),b=a.getData("width"),e=a.getData("height");c=this.getAlignedPos(c,
b,e);var f=c.x,g=c.y;c=a.getData("dimArray");var h=d.x-f;if(d.x<f||d.x>f+b||d.y>g||d.y<g-e)return false;e=0;f=c.length;var j=g;for(g=g;e<f;e++){var k=c[e];j-=k[0];g-=k[1];if(d.y>=j+(g-j)*h/b){b=+(h>b/2);return{name:a.getData("stringArray")[e],color:a.getData("colorArray")[e],value:a.getData("valueArray")[e][b],index:b}}}return false}}});$jit.AreaChart=new v({st:null,colors:["#416D9C","#70A35E","#EBB056","#C74243","#83548B","#909291","#557EAA"],selected:{},busy:false,initialize:function(a){this.controller=
this.config=i.merge(E("Canvas","Margin","Label","AreaChart"),{Label:{type:"Native"}},a);a=this.config.showLabels;var d=i.type(a),c=this.config.showAggregates,b=i.type(c);this.config.showLabels=d=="function"?a:i.lambda(a);this.config.showAggregates=b=="function"?c:i.lambda(c);this.initializeViz()},initializeViz:function(){var a=this.config,d=this,c=a.type.split(":")[0],b={};c=new $jit.ST({injectInto:a.injectInto,orientation:"bottom",levelDistance:0,siblingOffset:0,subtreeOffset:0,withLabels:a.Label.type!=
"Native",useCanvas:a.useCanvas,Label:{type:a.Label.type},Node:{overridable:true,type:"areachart-"+c,align:"left",width:1,height:1},Edge:{type:"none"},Tips:{enable:a.Tips.enable,type:"Native",force:true,onShow:function(g,h,j){a.Tips.onShow(g,j,h)}},Events:{enable:true,type:"Native",onClick:function(g,h,j){if(a.filterOnClick||a.Events.enable){(g=h.getContains())&&a.filterOnClick&&d.filter(g.name);a.Events.enable&&a.Events.onClick(g,h,j)}},onRightClick:function(){a.restoreOnRightClick&&d.restore()},
onMouseMove:function(g,h){if(a.selectOnHover)if(g){var j=h.getContains();d.select(g.id,j.name,j.index)}else d.select(false,false,false)}},onCreateLabel:function(g,h){var j=a.Label,k=h.getData("valueArray"),n=i.reduce(k,function(r,w){return r+w[0]},0);k=i.reduce(k,function(r,w){return r+w[1]},0);if(h.getData("prev")){var l={wrapper:document.createElement("div"),aggregate:document.createElement("div"),label:document.createElement("div")},m=l.wrapper,o=l.label,p=l.aggregate,q=m.style,t=o.style,x=p.style;
b[h.id]=l;m.appendChild(o);m.appendChild(p);if(!a.showLabels(h.name,n,k,h))o.style.display="none";if(!a.showAggregates(h.name,n,k,h))p.style.display="none";q.position="relative";q.overflow="visible";q.fontSize=j.size+"px";q.fontFamily=j.family;q.color=j.color;q.textAlign="center";x.position=t.position="absolute";g.style.width=h.getData("width")+"px";g.style.height=h.getData("height")+"px";o.innerHTML=h.name;g.appendChild(m)}},onPlaceLabel:function(g,h){if(h.getData("prev")){var j=b[h.id],k=j.wrapper.style,
n=j.label.style,l=j.aggregate.style,m=h.getData("width");h.getData("height");var o=h.getData("dimArray"),p=h.getData("valueArray"),q=i.reduce(p,function(w,s){return w+s[0]},0),t=i.reduce(p,function(w,s){return w+s[1]},0),x=parseInt(k.fontSize,10);if(o&&p){n.display=a.showLabels(h.name,q,t,h)?"":"none";l.display=a.showAggregates(h.name,q,t,h)?"":"none";k.width=l.width=n.width=g.style.width=m+"px";l.left=n.left=-m/2+"px";m=0;q=p.length;for(var r=t=0;m<q;m++)if(o[m][0]>0){t+=p[m][0];r+=o[m][0]}l.top=
-x-a.labelOffset+"px";n.top=a.labelOffset+r+"px";g.style.top=parseInt(g.style.top,10)-r+"px";g.style.height=k.height=r+"px";j.aggregate.innerHTML=t}}}});var e=c.canvas.getSize(),f=a.Margin;c.config.offsetY=-e.height/2+f.bottom+(a.showLabels&&a.labelOffset+a.Label.size);c.config.offsetX=(f.right-f.left)/2;this.st=c;this.canvas=this.st.canvas},loadJSON:function(a){var d=i.time(),c=[],b=this.st,e=i.splat(a.label),f=i.splat(a.color||this.colors),g=this.config,h=!!g.type.split(":")[1],j=g.animate,k=0;
a=a.values;for(var n=a.length;k<n-1;k++){var l=a[k],m=a[k-1],o=a[k+1],p=i.splat(a[k].values),q=i.splat(a[k+1].values);p=i.zip(p,q);c.push({id:d+l.label,name:l.label,data:{value:p,$valueArray:p,$colorArray:f,$stringArray:e,$next:o.label,$prev:m?m.label:false,$config:g,$gradient:h},children:[]})}b.loadJSON({id:d+"$root",name:"",data:{$type:"none",$width:1,$height:1},children:c});this.normalizeDims();b.compute();b.select(b.root);j&&b.fx.animate({modes:["node-property:height:dimArray"],duration:1500})},
updateJSON:function(a,d){if(!this.busy){this.busy=true;var c=this.st,b=c.graph,e=a.label&&i.splat(a.label),f=this.config.animate,g=this;i.each(a.values,function(h){var j=b.getByName(h.label);if(j){h.values=i.splat(h.values);var k=j.getData("stringArray"),n=j.getData("valueArray");i.each(n,function(m,o){m[0]=h.values[o];if(e)k[o]=e[o]});j.setData("valueArray",n);n=j.getData("prev");var l=j.getData("next");l=b.getByName(l);if(n)if(n=b.getByName(n)){n=n.getData("valueArray");i.each(n,function(m,o){m[1]=
h.values[o]})}if(!l){n=j.getData("valueArray");i.each(n,function(m,o){m[1]=h.values[o]})}}});this.normalizeDims();c.compute();c.select(c.root);f&&c.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){g.busy=false;d&&d.onComplete()}})}},filter:function(){if(!this.busy){this.busy=true;this.config.Tips.enable&&this.st.tips.hide();this.select(false,false,false);var a=Array.prototype.slice.call(arguments),d=this;this.st.graph.getNode(this.st.root).eachAdjacency(function(c){c=
c.nodeTo;var b=c.getData("dimArray"),e=c.getData("stringArray");c.setData("dimArray",i.map(b,function(f,g){return i.indexOf(a,e[g])>-1?f:[0,0]}),"end")});this.st.fx.animate({modes:["node-property:dimArray"],duration:1500,onComplete:function(){d.busy=false}})}},restore:function(){if(!this.busy){this.busy=true;this.config.Tips.enable&&this.st.tips.hide();this.select(false,false,false);this.normalizeDims();var a=this;this.st.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){a.busy=
false}})}},select:function(a,d,c){if(this.config.selectOnHover){var b=this.selected;if(b.id!=a||b.name!=d||b.index!=c){b.id=a;b.name=d;b.index=c;this.st.graph.eachNode(function(e){e.setData("border",false)});if(a){a=this.st.graph.getNode(a);a.setData("border",b);b=c===0?"prev":"next";if(b=a.getData(b))(a=this.st.graph.getByName(b))&&a.setData("border",{name:d,index:1-c})}this.st.plot()}}},getLegend:function(){var a={},d;this.st.graph.getNode(this.st.root).eachAdjacency(function(e){d=e.nodeTo});var c=
d.getData("colorArray"),b=c.length;i.each(d.getData("stringArray"),function(e,f){a[e]=c[f%b]});return a},getMaxValue:function(){var a=0;this.st.graph.eachNode(function(d){d=d.getData("valueArray");var c=0,b=0;i.each(d,function(e){c+=+e[0];b+=+e[1]});d=b>c?b:c;a=a>d?a:d});return a},normalizeDims:function(){var a=0;this.st.graph.getNode(this.st.root).eachAdjacency(function(){a++});var d=this.getMaxValue()||1,c=this.st.canvas.getSize(),b=this.config,e=b.Margin,f=b.labelOffset+b.Label.size,g=(c.width-
(e.left+e.right))/a,h=b.animate,j=c.height-(e.top+e.bottom)-(b.showAggregates&&f)-(b.showLabels&&f);this.st.graph.eachNode(function(k){var n=0,l=0,m=[];i.each(k.getData("valueArray"),function(p){n+=+p[0];l+=+p[1];m.push([0,0])});var o=l>n?l:n;k.setData("width",g);if(h){k.setData("height",o*j/d,"end");k.setData("dimArray",i.map(k.getData("valueArray"),function(p){return[p[0]*j/d,p[1]*j/d]}),"end");k.getData("dimArray")||k.setData("dimArray",m)}else{k.setData("height",o*j/d);k.setData("dimArray",i.map(k.getData("valueArray"),
function(p){return[p[0]*j/d,p[1]*j/d]}))}})}});E.PieChart={$extend:true,animate:true,offset:25,sliceOffset:0,labelOffset:3,type:"stacked",hoveredColor:"#9fd4ff",Events:{enable:false,onClick:i.empty},Tips:{enable:false,onShow:i.empty,onHide:i.empty},showLabels:true,resizeLabels:false,updateHeights:false};Q.Radial=new v({compute:function(a){a=i.splat(a||["current","start","end"]);ba.compute(this.graph,a,this.config);this.graph.computeLevels(this.root,0,"ignore");var d=this.createLevelDistanceFunc();
this.computeAngularWidths(a);this.computePositions(a,d)},computePositions:function(a,d){for(var c=this.graph,b=c.getNode(this.root),e=this.parent,f=0,g=a.length;f<g;f++){var h=a[f];b.setPos(new F(0,0),h);b.setData("span",Math.PI*2,h)}b.angleSpan={begin:0,end:2*Math.PI};c.eachBFS(this.root,function(j){var k=j.angleSpan.end-j.angleSpan.begin,n=j.angleSpan.begin,l=d(j),m=0,o=[],p={};j.eachSubnode(function(u){m+=u._treeAngularWidth;for(var C=0,B=a.length;C<B;C++){var A=a[C],D=u.getData("dim",A);p[A]=
A in p?D>p[A]?D:p[A]:D}o.push(u)},"ignore");e&&e.id==j.id&&o.length>0&&o[0].dist&&o.sort(function(u,C){return(u.dist>=C.dist)-(u.dist<=C.dist)});j=0;for(var q=o.length;j<q;j++){var t=o[j];if(!t._flag){for(var x=t._treeAngularWidth/m*k,r=n+x/2,w=0,s=a.length;w<s;w++){var z=a[w];t.setPos(new F(r,l),z);t.setData("span",x,z);t.setData("dim-quotient",t.getData("dim",z)/p[z],z)}t.angleSpan={begin:n,end:n+x};n+=x}}},"ignore")},setAngularWidthForNodes:function(a){this.graph.eachBFS(this.root,function(d,c){var b=
d.getData("angularWidth",a[0])||5;d._angularWidth=b/c},"ignore")},setSubtreesAngularWidth:function(){var a=this;this.graph.eachNode(function(d){a.setSubtreeAngularWidth(d)},"ignore")},setSubtreeAngularWidth:function(a){var d=this,c=a._angularWidth,b=0;a.eachSubnode(function(e){d.setSubtreeAngularWidth(e);b+=e._treeAngularWidth},"ignore");a._treeAngularWidth=Math.max(c,b)},computeAngularWidths:function(a){this.setAngularWidthForNodes(a);this.setSubtreesAngularWidth()}});$jit.Sunburst=new v({Implements:[X,
L,Q.Radial],initialize:function(a){var d=$jit.Sunburst;a=this.controller=this.config=i.merge(E("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label"),{interpolation:"linear",levelDistance:100,Node:{type:"multipie",height:0},Edge:{type:"none"},Label:{textAlign:"start",textBaseline:"middle"}},a);if(a.useCanvas){this.canvas=a.useCanvas;this.config.labelContainer=this.canvas.id+"-label"}else{if(a.background)a.background=i.merge({type:"Circles"},a.background);this.canvas=
new K(this,a);this.config.labelContainer=(typeof a.injectInto=="string"?a.injectInto:a.injectInto.id)+"-label"}this.graphOptions={complex:false,Node:{selected:false,exist:true,drawn:true}};this.graph=new y(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new d.Label[a.Label.type](this);this.fx=new d.Plot(this,d);this.op=new d.Op(this);this.rotated=this.root=this.json=null;this.busy=false;this.initializeExtras()},createLevelDistanceFunc:function(){var a=this.config.levelDistance;return function(d){return(d._depth+
1)*a}},refresh:function(){this.compute();this.plot()},reposition:function(){this.compute("end")},rotate:function(a,d,c){var b=a.getPos(c.property||"current").getp(true).theta;this.rotated=a;this.rotateAngle(-b,d,c)},rotateAngle:function(a,d,c){var b=i.merge(this.config,c||{},{modes:["polar"]}),e=c.property||(d==="animate"?"end":"current");d==="animate"&&this.fx.animation.pause();this.graph.eachNode(function(f){f=f.getPos(e);f.theta+=a;if(f.theta<0)f.theta+=Math.PI*2});if(d=="animate")this.fx.animate(b);
else if(d=="replot"){this.fx.plot();this.busy=false}},plot:function(){this.fx.plot()}});$jit.Sunburst.$extend=true;(function(a){a.Op=new v({Implements:y.Op});a.Plot=new v({Implements:y.Plot});a.Label={};a.Label.Native=new v({Implements:y.Label.Native,initialize:function(d){this.viz=d;this.label=d.config.Label;this.config=d.config},renderLabel:function(d,c){var b=c.getData("span");if(!(b<Math.PI/2&&Math.tan(b)*this.config.levelDistance*c._depth<10)){b=d.getCtx();var e=b.measureText(c.name);if(c.id==
this.viz.root)var f=-e.width/2,g=0,h=0;else{f=c.pos.clone();f.rho+=5;var j=f.getp(true);g=f.getc(true);f=g.x;g=g.y;h=Math.PI;var k=j.theta>h/2&&j.theta<3*h/2;h=k?j.theta+h:j.theta;if(k){f-=Math.abs(Math.cos(j.theta)*e.width);g+=Math.sin(j.theta)*e.width}else if(c.id==this.viz.root)f-=e.width/2}b.save();b.translate(f,g);b.rotate(h);b.fillText(c.name,0,0);b.restore()}}});a.Label.SVG=new v({Implements:y.Label.SVG,initialize:function(d){this.viz=d},placeLabel:function(d,c,b){var e=c.pos.getc(true),f=
this.viz,g=this.viz.canvas.getSize();e={x:Math.round(e.x+g.width/2),y:Math.round(e.y+g.height/2)};d.setAttribute("x",e.x);d.setAttribute("y",e.y);var h=d.getBBox();if(h){e=d.getAttribute("x");g=d.getAttribute("y");var j=c.pos.getp(true),k=Math.PI,n=j.theta>k/2&&j.theta<3*k/2;if(n){d.setAttribute("x",e-h.width);d.setAttribute("y",g-h.height)}else c.id==f.root&&d.setAttribute("x",e-h.width/2);f=n?j.theta+k:j.theta;c._depth&&d.setAttribute("transform","rotate("+f*360/(2*k)+" "+e+" "+g+")")}b.onPlaceLabel(d,
c)}});a.Label.HTML=new v({Implements:y.Label.HTML,initialize:function(d){this.viz=d},placeLabel:function(d,c,b){var e=c.pos.clone(),f=this.viz.canvas,g=c.getData("height");g=(g||c._depth==0?g:this.viz.config.levelDistance)/2;var h=f.getSize();e.rho+=g;e=e.getc(true);e={x:Math.round(e.x+h.width/2),y:Math.round(e.y+h.height/2)};g=d.style;g.left=e.x+"px";g.top=e.y+"px";g.display=this.fitsInCanvas(e,f)?"":"none";b.onPlaceLabel(d,c)}});a.Plot.NodeTypes=new v({none:{render:i.empty,contains:i.lambda(false),
anglecontains:function(d,c){var b=d.getData("span")/2,e=d.pos.theta,f=e-b;b=e+b;if(f<0)f+=Math.PI*2;e=Math.atan2(c.y,c.x);if(e<0)e+=Math.PI*2;return f>b?e>f&&e<=Math.PI*2||e<b:e>f&&e<b}},pie:{render:function(d,c){var b=d.getData("span")/2,e=d.pos.theta,f=e-b;b=e+b;e=d.pos.getp(true);var g=new F(e.rho,f),h=g.getc(true);g.theta=b;g=g.getc(true);var j=c.getCtx();j.beginPath();j.moveTo(0,0);j.lineTo(h.x,h.y);j.moveTo(0,0);j.lineTo(g.x,g.y);j.moveTo(0,0);j.arc(0,0,e.rho*d.getData("dim-quotient"),f,b,false);
j.fill()},contains:function(d,c){if(this.nodeTypes.none.anglecontains.call(this,d,c))return Math.sqrt(c.x*c.x+c.y*c.y)<=this.config.levelDistance*d._depth;return false}},multipie:{render:function(d,c){var b=d.getData("height");b=b?b:this.config.levelDistance;var e=d.getData("span")/2,f=d.pos.theta,g=f-e;e=f+e;f=d.pos.getp(true);var h=new F(f.rho,g),j=h.getc(true);h.theta=e;var k=h.getc(true);h.rho+=b;var n=h.getc(true);h.theta=g;h=h.getc(true);var l=c.getCtx();l.moveTo(0,0);l.beginPath();l.arc(0,
0,f.rho,g,e,false);l.arc(0,0,f.rho+b,e,g,true);l.moveTo(j.x,j.y);l.lineTo(h.x,h.y);l.moveTo(k.x,k.y);l.lineTo(n.x,n.y);l.fill();if(d.collapsed){l.save();l.lineWidth=2;l.moveTo(0,0);l.beginPath();l.arc(0,0,f.rho+b+5,e-0.01,g+0.01,true);l.stroke();l.restore()}},contains:function(d,c){if(this.nodeTypes.none.anglecontains.call(this,d,c)){var b=Math.sqrt(c.x*c.x+c.y*c.y),e=d.getData("height");e=e?e:this.config.levelDistance;var f=this.config.levelDistance,g=d._depth;return b>=f*g&&b<=f*g+e}return false}},
"gradient-multipie":{render:function(d,c){var b=c.getCtx(),e=d.getData("height");e=e?e:this.config.levelDistance;e=b.createRadialGradient(0,0,d.getPos().rho,0,0,d.getPos().rho+e);var f=i.hexToRgb(d.getData("color")),g=[];i.each(f,function(h){g.push(parseInt(h*0.5,10))});f=i.rgbToHex(g);e.addColorStop(0,f);e.addColorStop(1,d.getData("color"));b.fillStyle=e;this.nodeTypes.multipie.render.call(this,d,c)},contains:function(d,c){return this.nodeTypes.multipie.contains.call(this,d,c)}},"gradient-pie":{render:function(d,
c){var b=c.getCtx(),e=b.createRadialGradient(0,0,0,0,0,d.getPos().rho),f=i.hexToRgb(d.getData("color")),g=[];i.each(f,function(h){g.push(parseInt(h*0.5,10))});f=i.rgbToHex(g);e.addColorStop(1,f);e.addColorStop(0,d.getData("color"));b.fillStyle=e;this.nodeTypes.pie.render.call(this,d,c)},contains:function(d,c){return this.nodeTypes.pie.contains.call(this,d,c)}}});a.Plot.EdgeTypes=new v({none:i.empty,line:{render:function(d,c){var b=d.nodeFrom.pos.getc(true),e=d.nodeTo.pos.getc(true);this.edgeHelper.line.render(b,
e,c)},contains:function(d,c){var b=d.nodeFrom.pos.getc(true),e=d.nodeTo.pos.getc(true);return this.edgeHelper.line.contains(b,e,c,this.edge.epsilon)}},arrow:{render:function(d,c){var b=d.nodeFrom.pos.getc(true),e=d.nodeTo.pos.getc(true),f=d.getData("dim"),g=d.data.$direction;this.edgeHelper.arrow.render(b,e,f,g&&g.length>1&&g[0]!=d.nodeFrom.id,c)},contains:function(d,c){var b=d.nodeFrom.pos.getc(true),e=d.nodeTo.pos.getc(true);return this.edgeHelper.arrow.contains(b,e,c,this.edge.epsilon)}},hyperline:{render:function(d,
c){var b=d.nodeFrom.pos.getc(),e=d.nodeTo.pos.getc(),f=Math.max(b.norm(),e.norm());this.edgeHelper.hyperline.render(b.$scale(1/f),e.$scale(1/f),f,c)},contains:i.lambda(false)}})})($jit.Sunburst);$jit.Sunburst.Plot.NodeTypes.implement({"piechart-stacked":{render:function(a,d){a.pos.getp(true);var c=a.getData("dimArray"),b=a.getData("valueArray"),e=a.getData("colorArray"),f=e.length,g=a.getData("stringArray"),h=a.getData("span")/2,j=a.pos.theta,k=j-h,n=j+h;j=new F;h=d.getCtx();var l={},m=a.getData("gradient"),
o=a.getData("border"),p=a.getData("config"),q=p.showLabels,t=p.resizeLabels,x=p.Label,r=p.sliceOffset*Math.cos((k+n)/2),w=p.sliceOffset*Math.sin((k+n)/2);if(e&&c&&g){for(var s=0,z=c.length,u=0,C=0;s<z;s++){var B=c[s],A=e[s%f];if(!(B<=0)){h.fillStyle=h.strokeStyle=A;if(m&&B){var D=h.createRadialGradient(r,w,u+p.sliceOffset,r,w,u+B+p.sliceOffset),I=i.hexToRgb(A);I=i.map(I,function(J){return J*0.8>>0});I=i.rgbToHex(I);D.addColorStop(0,A);D.addColorStop(0.5,A);D.addColorStop(1,I);h.fillStyle=D}j.rho=
u+p.sliceOffset;j.theta=k;j.getc(true);j.theta=n;j.getc(true);j.rho+=B;j.getc(true);j.theta=k;j.getc(true);h.beginPath();h.arc(r,w,u+0.01,k,n,false);h.arc(r,w,u+B+0.01,n,k,true);h.fill();if(o&&o.name==g[s]){l.acum=u;l.dimValue=c[s];l.begin=k;l.end=n}u+=B||0;C+=b[s]||0}}if(o){h.save();h.globalCompositeOperation="source-over";h.lineWidth=2;h.strokeStyle=o.color;h.beginPath();h.arc(r,w,l.acum+0.01+1,l.begin,l.end,false);h.arc(r,w,l.acum+l.dimValue+0.01-1,l.end,l.begin,true);h.closePath();h.stroke();
h.restore()}if(q&&x.type=="Native"){h.save();h.fillStyle=h.strokeStyle=x.color;c=t?a.getData("normalizedDim"):1;c=x.size*c>>0;c=c<+t?+t:c;h.font=x.style+" "+c+"px "+x.family;h.textBaseline="middle";h.textAlign="center";j.rho=u+p.labelOffset+p.sliceOffset;j.theta=a.pos.theta;c=j.getc(true);h.fillText(a.name,c.x,c.y);h.restore()}}},contains:function(a,d){if(this.nodeTypes.none.anglecontains.call(this,a,d)){var c=Math.sqrt(d.x*d.x+d.y*d.y),b=this.config.levelDistance,e=a._depth,f=a.getData("config");
if(c<=b*e+f.sliceOffset){b=a.getData("dimArray");e=0;var g=b.length;for(f=f.sliceOffset;e<g;e++){var h=b[e];if(c>=f&&c<=f+h)return{name:a.getData("stringArray")[e],color:a.getData("colorArray")[e],value:a.getData("valueArray")[e],label:a.name};f+=h}}return false}return false}}});$jit.PieChart=new v({sb:null,colors:["#416D9C","#70A35E","#EBB056","#C74243","#83548B","#909291","#557EAA"],selected:{},busy:false,initialize:function(a){this.controller=this.config=i.merge(E("Canvas","PieChart","Label"),
{Label:{type:"Native"}},a);this.initializeViz()},initializeViz:function(){var a=this.config,d=this,c=a.type.split(":")[0];c=new $jit.Sunburst({injectInto:a.injectInto,useCanvas:a.useCanvas,withLabels:a.Label.type!="Native",Label:{type:a.Label.type},Node:{overridable:true,type:"piechart-"+c,width:1,height:1},Edge:{type:"none"},Tips:{enable:a.Tips.enable,type:"Native",force:true,onShow:function(f,g,h){a.Tips.onShow(f,h,g)}},Events:{enable:true,type:"Native",onClick:function(f,g,h){if(a.Events.enable){f=
g.getContains();a.Events.onClick(f,g,h)}},onMouseMove:function(f,g){if(a.hoveredColor)if(f){var h=g.getContains();d.select(f.id,h.name,h.index)}else d.select(false,false,false)}},onCreateLabel:function(f,g){var h=a.Label;if(a.showLabels){var j=f.style;j.fontSize=h.size+"px";j.fontFamily=h.family;j.color=h.color;j.textAlign="center";f.innerHTML=g.name}},onPlaceLabel:function(f,g){if(a.showLabels){var h=g.pos.getp(true),j=g.getData("dimArray"),k=g.getData("span")/2,n=g.pos.theta;h=n-k;k=n+k;n=new F;
var l=a.resizeLabels,m=a.Label;if(j){for(var o=0,p=j.length,q=0;o<p;o++)q+=j[o];j=l?g.getData("normalizedDim"):1;j=m.size*j>>0;j=j<+l?+l:j;f.style.fontSize=j+"px";n.rho=q+a.labelOffset+a.sliceOffset;n.theta=(h+k)/2;h=n.getc(true);j=d.canvas.getSize();h={x:Math.round(h.x+j.width/2),y:Math.round(h.y+j.height/2)};f.style.left=h.x+"px";f.style.top=h.y+"px"}}}});var b=c.canvas.getSize(),e=Math.min;c.config.levelDistance=e(b.width,b.height)/2-a.offset-a.sliceOffset;this.sb=c;this.canvas=this.sb.canvas;
this.canvas.getCtx().globalCompositeOperation="lighter"},loadJSON:function(a){var d=i.time(),c=[],b=this.sb,e=i.splat(a.label),f=e.length,g=i.splat(a.color||this.colors),h=g.length,j=this.config,k=!!j.type.split(":")[1],n=j.animate;f=f==1;var l=0;a=a.values;for(var m=a.length;l<m;l++){var o=a[l],p=i.splat(o.values);c.push({id:d+o.label,name:o.label,data:{value:p,$valueArray:p,$colorArray:f?i.splat(g[l%h]):g,$stringArray:e,$gradient:k,$config:j,$angularWidth:i.reduce(p,function(q,t){return q+t})},
children:[]})}b.loadJSON({id:d+"$root",name:"",data:{$type:"none",$width:1,$height:1},children:c});this.normalizeDims();b.refresh();n&&b.fx.animate({modes:["node-property:dimArray"],duration:1500})},updateJSON:function(a,d){if(!this.busy){this.busy=true;var c=this.sb,b=c.graph,e=this.config.animate,f=this;i.each(a.values,function(g){var h=b.getByName(g.label);g=i.splat(g.values);if(h){h.setData("valueArray",g);h.setData("angularWidth",i.reduce(g,function(j,k){return j+k}));a.label&&h.setData("stringArray",
i.splat(a.label))}});this.normalizeDims();if(e){c.compute("end");c.fx.animate({modes:["node-property:dimArray:span","linear"],duration:1500,onComplete:function(){f.busy=false;d&&d.onComplete()}})}else c.refresh()}},select:function(a,d){if(this.config.hoveredColor){var c=this.selected;if(c.id!=a||c.name!=d){c.id=a;c.name=d;c.color=this.config.hoveredColor;this.sb.graph.eachNode(function(b){a==b.id?b.setData("border",c):b.setData("border",false)});this.sb.plot()}}},getLegend:function(){var a={},d;this.sb.graph.getNode(this.sb.root).eachAdjacency(function(e){d=
e.nodeTo});var c=d.getData("colorArray"),b=c.length;i.each(d.getData("stringArray"),function(e,f){a[e]=c[f%b]});return a},getMaxValue:function(){var a=0;this.sb.graph.eachNode(function(d){d=d.getData("valueArray");var c=0;i.each(d,function(b){c+=+b});a=a>c?a:c});return a},normalizeDims:function(){var a=0;this.sb.graph.getNode(this.sb.root).eachAdjacency(function(){a++});var d=this.getMaxValue()||1,c=this.config,b=c.animate,e=this.sb.config.levelDistance;this.sb.graph.eachNode(function(f){var g=0,
h=[];i.each(f.getData("valueArray"),function(k){g+=+k;h.push(1)});var j=h.length==1&&!c.updateHeights;if(b){f.setData("dimArray",i.map(f.getData("valueArray"),function(k){return j?e:k*e/d}),"end");f.getData("dimArray")||f.setData("dimArray",h)}else f.setData("dimArray",i.map(f.getData("valueArray"),function(k){return j?e:k*e/d}));f.setData("normalizedDim",g/d)})}});$jit.RGraph=new v({Implements:[X,L,Q.Radial],initialize:function(a){var d=$jit.RGraph;a=this.controller=this.config=i.merge(E("Canvas",
"Node","Edge","Fx","Controller","Tips","NodeStyles","Events","Navigation","Label"),{interpolation:"linear",levelDistance:100},a);if(a.useCanvas){this.canvas=a.useCanvas;this.config.labelContainer=this.canvas.id+"-label"}else{if(a.background)a.background=i.merge({type:"Circles"},a.background);this.canvas=new K(this,a);this.config.labelContainer=(typeof a.injectInto=="string"?a.injectInto:a.injectInto.id)+"-label"}this.graphOptions={complex:false,Node:{selected:false,exist:true,drawn:true}};this.graph=
new y(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new d.Label[a.Label.type](this);this.fx=new d.Plot(this,d);this.op=new d.Op(this);this.root=this.json=null;this.parent=this.busy=false;this.initializeExtras()},createLevelDistanceFunc:function(){var a=this.config.levelDistance;return function(d){return(d._depth+1)*a}},refresh:function(){this.compute();this.plot()},reposition:function(){this.compute("end")},plot:function(){this.fx.plot()},getNodeAndParentAngle:function(a){var d=
false,c=this.graph.getNode(a);a=c.getParents();if(a=a.length>0?a[0]:false){d=a.pos.getc();c=c.pos.getc();d=d.add(c.scale(-1));d=Math.atan2(d.y,d.x);if(d<0)d+=2*Math.PI}return{parent:a,theta:d}},tagChildren:function(a,d){if(a.angleSpan){var c=[];a.eachAdjacency(function(g){c.push(g.nodeTo)},"ignore");for(var b=c.length,e=0;e<b&&d!=c[e].id;e++);e=(e+1)%b;for(var f=0;d!=c[e].id;e=(e+1)%b)c[e].dist=f++}},onClick:function(a,d){if(this.root!=a&&!this.busy){this.busy=true;this.root=a;that=this;this.controller.onBeforeCompute(this.graph.getNode(a));
var c=this.getNodeAndParentAngle(a);this.tagChildren(c.parent,a);this.parent=c.parent;this.compute("end");var b=c.theta-c.parent.endPos.theta;this.graph.eachNode(function(e){e.endPos.set(e.endPos.getp().add(new F(b,0)))});c=this.config.interpolation;d=i.merge({onComplete:i.empty},d||{});this.fx.animate(i.merge({hideLabels:true,modes:[c]},d,{onComplete:function(){that.busy=false;d.onComplete()}}))}}});$jit.RGraph.$extend=true;(function(a){a.Op=new v({Implements:y.Op});a.Plot=new v({Implements:y.Plot});
a.Label={};a.Label.Native=new v({Implements:y.Label.Native});a.Label.SVG=new v({Implements:y.Label.SVG,initialize:function(d){this.viz=d},placeLabel:function(d,c,b){var e=c.pos.getc(true),f=this.viz.canvas,g=f.translateOffsetX,h=f.translateOffsetY,j=f.scaleOffsetX,k=f.scaleOffsetY;f=f.getSize();e={x:Math.round(e.x*j+g+f.width/2),y:Math.round(e.y*k+h+f.height/2)};d.setAttribute("x",e.x);d.setAttribute("y",e.y);b.onPlaceLabel(d,c)}});a.Label.HTML=new v({Implements:y.Label.HTML,initialize:function(d){this.viz=
d},placeLabel:function(d,c,b){var e=c.pos.getc(true),f=this.viz.canvas,g=f.translateOffsetX,h=f.translateOffsetY,j=f.scaleOffsetX,k=f.scaleOffsetY,n=f.getSize();e={x:Math.round(e.x*j+g+n.width/2),y:Math.round(e.y*k+h+n.height/2)};g=d.style;g.left=e.x+"px";g.top=e.y+"px";g.display=this.fitsInCanvas(e,f)?"":"none";b.onPlaceLabel(d,c)}});a.Plot.NodeTypes=new v({none:{render:i.empty,contains:i.lambda(false)},circle:{render:function(d,c){var b=d.pos.getc(true),e=d.getData("dim");this.nodeHelper.circle.render("fill",
b,e,c)},contains:function(d,c){var b=d.pos.getc(true),e=d.getData("dim");return this.nodeHelper.circle.contains(b,c,e)}},ellipse:{render:function(d,c){var b=d.pos.getc(true),e=d.getData("width"),f=d.getData("height");this.nodeHelper.ellipse.render("fill",b,e,f,c)},contains:function(d,c){var b=d.pos.getc(true),e=d.getData("width"),f=d.getData("height");return this.nodeHelper.ellipse.contains(b,c,e,f)}},square:{render:function(d,c){var b=d.pos.getc(true),e=d.getData("dim");this.nodeHelper.square.render("fill",
b,e,c)},contains:function(d,c){var b=d.pos.getc(true),e=d.getData("dim");return this.nodeHelper.square.contains(b,c,e)}},rectangle:{render:function(d,c){var b=d.pos.getc(true),e=d.getData("width"),f=d.getData("height");this.nodeHelper.rectangle.render("fill",b,e,f,c)},contains:function(d,c){var b=d.pos.getc(true),e=d.getData("width"),f=d.getData("height");return this.nodeHelper.rectangle.contains(b,c,e,f)}},triangle:{render:function(d,c){var b=d.pos.getc(true),e=d.getData("dim");this.nodeHelper.triangle.render("fill",
b,e,c)},contains:function(d,c){var b=d.pos.getc(true),e=d.getData("dim");return this.nodeHelper.triangle.contains(b,c,e)}},star:{render:function(d,c){var b=d.pos.getc(true),e=d.getData("dim");this.nodeHelper.star.render("fill",b,e,c)},contains:function(d,c){var b=d.pos.getc(true),e=d.getData("dim");return this.nodeHelper.star.contains(b,c,e)}}});a.Plot.EdgeTypes=new v({none:i.empty,line:{render:function(d,c){var b=d.nodeFrom.pos.getc(true),e=d.nodeTo.pos.getc(true);this.edgeHelper.line.render(b,e,
c)},contains:function(d,c){var b=d.nodeFrom.pos.getc(true),e=d.nodeTo.pos.getc(true);return this.edgeHelper.line.contains(b,e,c,this.edge.epsilon)}},arrow:{render:function(d,c){var b=d.nodeFrom.pos.getc(true),e=d.nodeTo.pos.getc(true),f=d.getData("dim"),g=d.data.$direction;this.edgeHelper.arrow.render(b,e,f,g&&g.length>1&&g[0]!=d.nodeFrom.id,c)},contains:function(d,c){var b=d.nodeFrom.pos.getc(true),e=d.nodeTo.pos.getc(true);return this.edgeHelper.arrow.contains(b,e,c,this.edge.epsilon)}}})})($jit.RGraph);
E.BarChart={$extend:true,animate:true,type:"stacked",labelOffset:3,barsOffset:0,hoveredColor:"#9fd4ff",orientation:"horizontal",showAggregates:true,showLabels:true,Tips:{enable:false,onShow:i.empty,onHide:i.empty},Events:{enable:false,onClick:i.empty}};$jit.ST.Plot.NodeTypes.implement({"barchart-stacked":{render:function(a,d){var c=a.pos.getc(true),b=a.getData("width"),e=a.getData("height"),f=this.getAlignedPos(c,b,e);c=f.x;f=f.y;var g=a.getData("dimArray"),h=a.getData("valueArray"),j=a.getData("colorArray"),
k=j.length,n=a.getData("stringArray"),l=d.getCtx(),m={},o=a.getData("border"),p=a.getData("gradient"),q=a.getData("config"),t=q.orientation=="horizontal",x=q.showAggregates,r=q.showLabels,w=q.Label;if(j&&g&&n){for(var s=0,z=g.length,u=0,C=0;s<z;s++){l.fillStyle=l.strokeStyle=j[s%k];if(p){var B;B=t?l.createLinearGradient(c+u+g[s]/2,f,c+u+g[s]/2,f+e):l.createLinearGradient(c,f-u-g[s]/2,c+b,f-u-g[s]/2);var A=i.rgbToHex(i.map(i.hexToRgb(j[s%k].slice(1)),function(D){return D*0.5>>0}));B.addColorStop(0,
A);B.addColorStop(0.5,j[s%k]);B.addColorStop(1,A);l.fillStyle=B}t?l.fillRect(c+u,f,g[s],e):l.fillRect(c,f-u-g[s],b,g[s]);if(o&&o.name==n[s]){m.acum=u;m.dimValue=g[s]}u+=g[s]||0;C+=h[s]||0}if(o){l.save();l.lineWidth=2;l.strokeStyle=o.color;t?l.strokeRect(c+m.acum+1,f+1,m.dimValue-2,e-2):l.strokeRect(c+1,f-m.acum-m.dimValue+1,b-2,m.dimValue-2);l.restore()}if(w.type=="Native"){l.save();l.fillStyle=l.strokeStyle=w.color;l.font=w.style+" "+w.size+"px "+w.family;l.textBaseline="middle";if(x(a.name,C))if(t){l.textAlign=
"right";l.fillText(C,c+u-q.labelOffset,f+e/2)}else{l.textAlign="center";l.fillText(C,c+b/2,f-e-w.size/2-q.labelOffset)}if(r(a.name,C,a))if(t){l.textAlign="center";l.translate(c-q.labelOffset-w.size/2,f+e/2);l.rotate(Math.PI/2);l.fillText(a.name,0,0)}else{l.textAlign="center";l.fillText(a.name,c+b/2,f+w.size/2+q.labelOffset)}l.restore()}}},contains:function(a,d){var c=a.pos.getc(true),b=a.getData("width"),e=a.getData("height");c=this.getAlignedPos(c,b,e);var f=c.x,g=c.y;c=a.getData("dimArray");var h=
a.getData("config").orientation=="horizontal";if(h){if(d.x<f||d.x>f+b||d.y>g+e||d.y<g)return false}else if(d.x<f||d.x>f+b||d.y>g||d.y<g-e)return false;b=0;e=c.length;for(f=h?f:g;b<e;b++){g=c[b];if(h){f+=g;g=f;if(d.x<=g)return{name:a.getData("stringArray")[b],color:a.getData("colorArray")[b],value:a.getData("valueArray")[b],label:a.name}}else{f-=g;g=f;if(d.y>=g)return{name:a.getData("stringArray")[b],color:a.getData("colorArray")[b],value:a.getData("valueArray")[b],label:a.name}}}return false}},"barchart-grouped":{render:function(a,
d){var c=a.pos.getc(true),b=a.getData("width"),e=a.getData("height"),f=this.getAlignedPos(c,b,e);c=f.x;f=f.y;var g=a.getData("dimArray"),h=a.getData("valueArray"),j=h.length,k=a.getData("colorArray"),n=k.length,l=a.getData("stringArray"),m=d.getCtx(),o={},p=a.getData("border"),q=a.getData("gradient"),t=a.getData("config"),x=t.orientation=="horizontal",r=t.showAggregates,w=t.showLabels,s=t.Label,z=(x?e:b)/j;if(k&&g&&l){for(var u=0,C=0,B=0;u<j;u++){m.fillStyle=m.strokeStyle=k[u%n];if(q){var A;A=x?m.createLinearGradient(c+
g[u]/2,f+z*u,c+g[u]/2,f+z*(u+1)):m.createLinearGradient(c+z*u,f-g[u]/2,c+z*(u+1),f-g[u]/2);var D=i.rgbToHex(i.map(i.hexToRgb(k[u%n].slice(1)),function(I){return I*0.5>>0}));A.addColorStop(0,D);A.addColorStop(0.5,k[u%n]);A.addColorStop(1,D);m.fillStyle=A}x?m.fillRect(c,f+z*u,g[u],z):m.fillRect(c+z*u,f-g[u],z,g[u]);if(p&&p.name==l[u]){o.acum=z*u;o.dimValue=g[u]}C+=g[u]||0;B+=h[u]||0}if(p){m.save();m.lineWidth=2;m.strokeStyle=p.color;x?m.strokeRect(c+1,f+o.acum+1,o.dimValue-2,z-2):m.strokeRect(c+o.acum+
1,f-o.dimValue+1,z-2,o.dimValue-2);m.restore()}if(s.type=="Native"){m.save();m.fillStyle=m.strokeStyle=s.color;m.font=s.style+" "+s.size+"px "+s.family;m.textBaseline="middle";if(r(a.name,B))if(x){m.textAlign="right";m.fillText(B,c+Math.max.apply(null,g)-t.labelOffset,f+e/2)}else{m.textAlign="center";m.fillText(B,c+b/2,f-Math.max.apply(null,g)-s.size/2-t.labelOffset)}if(w(a.name,B,a))if(x){m.textAlign="center";m.translate(c-t.labelOffset-s.size/2,f+e/2);m.rotate(Math.PI/2);m.fillText(a.name,0,0)}else{m.textAlign=
"center";m.fillText(a.name,c+b/2,f+s.size/2+t.labelOffset)}m.restore()}}},contains:function(a,d){var c=a.pos.getc(true),b=a.getData("width"),e=a.getData("height"),f=this.getAlignedPos(c,b,e);c=f.x;f=f.y;var g=a.getData("dimArray"),h=g.length,j=a.getData("config").orientation=="horizontal";h=(j?e:b)/h;if(j){if(d.x<c||d.x>c+b||d.y>f+e||d.y<f)return false}else if(d.x<c||d.x>c+b||d.y>f||d.y<f-e)return false;b=0;for(e=g.length;b<e;b++){var k=g[b];if(j){var n=f+h*b;if(d.x<=c+k&&d.y>=n&&d.y<=n+h)return{name:a.getData("stringArray")[b],
color:a.getData("colorArray")[b],value:a.getData("valueArray")[b],label:a.name}}else{n=c+h*b;if(d.x>=n&&d.x<=n+h&&d.y>=f-k)return{name:a.getData("stringArray")[b],color:a.getData("colorArray")[b],value:a.getData("valueArray")[b],label:a.name}}}return false}}});$jit.BarChart=new v({st:null,colors:["#416D9C","#70A35E","#EBB056","#C74243","#83548B","#909291","#557EAA"],selected:{},busy:false,initialize:function(a){this.controller=this.config=i.merge(E("Canvas","Margin","Label","BarChart"),{Label:{type:"Native"}},
a);a=this.config.showLabels;var d=i.type(a),c=this.config.showAggregates,b=i.type(c);this.config.showLabels=d=="function"?a:i.lambda(a);this.config.showAggregates=b=="function"?c:i.lambda(c);this.initializeViz()},initializeViz:function(){var a=this.config,d=this,c=a.type.split(":")[0],b=a.orientation=="horizontal",e={};c=new $jit.ST({injectInto:a.injectInto,orientation:b?"left":"bottom",levelDistance:0,siblingOffset:a.barsOffset,subtreeOffset:0,withLabels:a.Label.type!="Native",useCanvas:a.useCanvas,
Label:{type:a.Label.type},Node:{overridable:true,type:"barchart-"+c,align:"left",width:1,height:1},Edge:{type:"none"},Tips:{enable:a.Tips.enable,type:"Native",force:true,onShow:function(h,j,k){a.Tips.onShow(h,k,j)}},Events:{enable:true,type:"Native",onClick:function(h,j,k){if(a.Events.enable){h=j.getContains();a.Events.onClick(h,j,k)}},onMouseMove:function(h,j){if(a.hoveredColor)if(h){var k=j.getContains();d.select(h.id,k.name,k.index)}else d.select(false,false,false)}},onCreateLabel:function(h,j){var k=
a.Label,n=j.getData("valueArray");n=i.reduce(n,function(r,w){return r+w},0);var l={wrapper:document.createElement("div"),aggregate:document.createElement("div"),label:document.createElement("div")},m=l.wrapper,o=l.label,p=l.aggregate,q=m.style,t=o.style,x=p.style;e[j.id]=l;m.appendChild(o);m.appendChild(p);if(!a.showLabels(j.name,n,j))t.display="none";if(!a.showAggregates(j.name,n,j))x.display="none";q.position="relative";q.overflow="visible";q.fontSize=k.size+"px";q.fontFamily=k.family;q.color=k.color;
q.textAlign="center";x.position=t.position="absolute";h.style.width=j.getData("width")+"px";h.style.height=j.getData("height")+"px";x.left=t.left="0px";o.innerHTML=j.name;h.appendChild(m)},onPlaceLabel:function(h,j){if(e[j.id]){var k=e[j.id],n=k.wrapper.style,l=k.label.style,m=k.aggregate.style,o=a.type.split(":")[0]=="grouped",p=a.orientation=="horizontal",q=j.getData("dimArray"),t=j.getData("valueArray"),x=o&&p?Math.max.apply(null,q):j.getData("width");o=o&&!p?Math.max.apply(null,q):j.getData("height");
p=parseInt(n.fontSize,10);if(q&&t){n.width=m.width=l.width=h.style.width=x+"px";x=0;for(var r=t.length,w=0;x<r;x++)if(q[x]>0)w+=t[x];l.display=a.showLabels(j.name,w,j)?"":"none";m.display=a.showAggregates(j.name,w,j)?"":"none";if(a.orientation=="horizontal"){m.textAlign="right";l.textAlign="left";l.textIndex=m.textIndent=a.labelOffset+"px";m.top=l.top=(o-p)/2+"px"}else{m.top=-p-a.labelOffset+"px";l.top=a.labelOffset+o+"px";h.style.top=parseInt(h.style.top,10)-o+"px"}h.style.height=n.height=o+"px";
k.aggregate.innerHTML=w}}}});var f=c.canvas.getSize(),g=a.Margin;if(b){c.config.offsetX=f.width/2-g.left-(a.showLabels&&a.labelOffset+a.Label.size);c.config.offsetY=(g.bottom-g.top)/2}else{c.config.offsetY=-f.height/2+g.bottom+(a.showLabels&&a.labelOffset+a.Label.size);c.config.offsetX=(g.right-g.left)/2}this.st=c;this.canvas=this.st.canvas},loadJSON:function(a){if(!this.busy){this.busy=true;var d=i.time(),c=[],b=this.st,e=i.splat(a.label),f=i.splat(a.color||this.colors),g=this.config,h=!!g.type.split(":")[1],
j=g.animate,k=g.orientation=="horizontal",n=this,l=0;a=a.values;for(var m=a.length;l<m;l++){var o=a[l],p=i.splat(a[l].values);c.push({id:d+o.label,name:o.label,data:{value:p,$valueArray:p,$colorArray:f,$stringArray:e,$gradient:h,$config:g},children:[]})}b.loadJSON({id:d+"$root",name:"",data:{$type:"none",$width:1,$height:1},children:c});this.normalizeDims();b.compute();b.select(b.root);if(j)k?b.fx.animate({modes:["node-property:width:dimArray"],duration:1500,onComplete:function(){n.busy=false}}):
b.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){n.busy=false}});else this.busy=false}},updateJSON:function(a,d){if(!this.busy){this.busy=true;var c=this.st,b=c.graph,e=this.config.animate,f=this,g=this.config.orientation=="horizontal";i.each(a.values,function(h){var j=b.getByName(h.label);if(j){j.setData("valueArray",i.splat(h.values));a.label&&j.setData("stringArray",i.splat(a.label))}});this.normalizeDims();c.compute();c.select(c.root);if(e)g?c.fx.animate({modes:["node-property:width:dimArray"],
duration:1500,onComplete:function(){f.busy=false;d&&d.onComplete()}}):c.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){f.busy=false;d&&d.onComplete()}})}},select:function(a,d){if(this.config.hoveredColor){var c=this.selected;if(c.id!=a||c.name!=d){c.id=a;c.name=d;c.color=this.config.hoveredColor;this.st.graph.eachNode(function(b){a==b.id?b.setData("border",c):b.setData("border",false)});this.st.plot()}}},getLegend:function(){var a={},d;this.st.graph.getNode(this.st.root).eachAdjacency(function(e){d=
e.nodeTo});var c=d.getData("colorArray"),b=c.length;i.each(d.getData("stringArray"),function(e,f){a[e]=c[f%b]});return a},getMaxValue:function(){var a=0,d=this.config.type.split(":")[0]=="stacked";this.st.graph.eachNode(function(c){c=c.getData("valueArray");var b=0;if(c){if(d)i.each(c,function(e){b+=+e});else b=Math.max.apply(null,c);a=a>b?a:b}});return a},setBarType:function(a){this.config.type=a;this.st.config.Node.type="barchart-"+a.split(":")[0]},normalizeDims:function(){var a=0;this.st.graph.getNode(this.st.root).eachAdjacency(function(){a++});
var d=this.getMaxValue()||1,c=this.st.canvas.getSize(),b=this.config,e=b.Margin,f=e.left+e.right;e=e.top+e.bottom;var g=b.orientation=="horizontal",h=(c[g?"height":"width"]-(g?e:f)-(a-1)*b.barsOffset)/a,j=b.animate,k=c[g?"width":"height"]-(g?f:e)-(!g&&b.showAggregates&&b.Label.size+b.labelOffset)-(b.showLabels&&b.Label.size+b.labelOffset),n=g?"height":"width",l=g?"width":"height";this.st.graph.eachNode(function(m){var o=0,p=[];i.each(m.getData("valueArray"),function(q){o+=+q;p.push(0)});m.setData(n,
h);if(j){m.setData(l,o*k/d,"end");m.setData("dimArray",i.map(m.getData("valueArray"),function(q){return q*k/d}),"end");m.getData("dimArray")||m.setData("dimArray",p)}else{m.setData(l,o*k/d);m.setData("dimArray",i.map(m.getData("valueArray"),function(q){return q*k/d}))}})}})})();
